(()=>{"use strict";var e={n:a=>{var t=a&&a.__esModule?()=>a.default:()=>a;return e.d(t,{a:t}),t},d:(a,t)=>{for(var r in t)e.o(t,r)&&!e.o(a,r)&&Object.defineProperty(a,r,{enumerable:!0,get:t[r]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a)};const a=window.React,t=window.wp.element,r=window.wp.apiFetch;var n=e.n(r);const l="/rz-file-manager/v1",s=async(e,a)=>{try{const t=new FormData;t.append("file",a),t.append("path",e);const r=`${window.rzFileManager?.restUrl||"/wp-json"+l}/upload`,n=await fetch(r,{method:"POST",headers:{"X-WP-Nonce":window.rzFileManager?.nonce},body:t});return await n.json()}catch(e){return console.error("Error uploading file:",e),{success:!1,message:e.message}}},o=async e=>{try{return await n()({path:`${l}/delete`,method:"DELETE",data:{path:e}})}catch(e){return console.error("Error deleting item:",e),{success:!1,message:e.message}}},c=(0,t.createContext)(),m=({children:e})=>{const[r,m]=(0,t.useState)(""),[i,d]=(0,t.useState)([]),[u,g]=(0,t.useState)([]),[f,_]=(0,t.useState)(!1),[p,h]=(0,t.useState)(null),[E,z]=(0,t.useState)(null),y=async()=>{_(!0),h(null);try{const e=await(async(e="")=>{try{console.log("fetchFiles called with path:",e),console.log("rzFileManager object:",window.rzFileManager);const a=`${window.rzFileManager?.restUrl}list`;console.log("Attempting standard fetch with URL:",a);const t=await fetch(`${a}?path=${encodeURIComponent(e)}`,{method:"GET",credentials:"include",headers:{"X-WP-Nonce":window.rzFileManager?.nonce,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(e){return console.error("Error in fetchFiles (standard fetch):",e),{success:!1,message:e.message}}})(r);e.success?d(e.items):h(e.message||"Failed to load files")}catch(e){h("Error loading files: "+(e.message||"Unknown error"))}finally{_(!1)}},w=e=>{m(e),g([])};(0,t.useEffect)((()=>{y()}),[r]),(0,t.useEffect)((()=>{if(E){const e=setTimeout((()=>{z(null)}),3e3);return()=>clearTimeout(e)}}),[E]);const v={currentPath:r,items:i,selectedItems:u,loading:f,error:p,successMessage:E,navigateTo:w,navigateToParent:()=>{if(!r)return;const e=r.split("/");e.pop();const a=e.join("/");w(a)},toggleSelectItem:e=>{g((a=>a.some((a=>a.path===e.path))?a.filter((a=>a.path!==e.path)):[...a,e]))},isItemSelected:e=>u.some((a=>a.path===e.path)),clearSelection:()=>{g([])},clearMessages:()=>{h(null),z(null)},handleCreateFolder:async e=>{_(!0),h(null);try{const a=await(async(e,a)=>{try{return await n()({path:`${l}/create-folder`,method:"POST",data:{path:e,name:a}})}catch(e){return console.error("Error creating folder:",e),{success:!1,message:e.message}}})(r,e);a.success?(z(a.message||"Folder created successfully"),await y()):h(a.message||"Failed to create folder")}catch(e){h("Error creating folder: "+(e.message||"Unknown error"))}finally{_(!1)}},handleUploadFiles:async e=>{_(!0),h(null);try{for(let a=0;a<e.length;a++){const t=e[a],n=await s(r,t);if(!n.success){h(`Failed to upload ${t.name}: ${n.message||"Unknown error"}`);break}}z("Files uploaded successfully"),await y()}catch(e){h("Error uploading files: "+(e.message||"Unknown error"))}finally{_(!1)}},handleDeleteItems:async()=>{if(0!==u.length){_(!0),h(null);try{for(const e of u){const a=await o(e.path);if(!a.success){h(`Failed to delete ${e.name}: ${a.message||"Unknown error"}`);break}}z("Items deleted successfully"),g([]),await y()}catch(e){h("Error deleting items: "+(e.message||"Unknown error"))}finally{_(!1)}}},handleRenameItem:async(e,a)=>{_(!0),h(null);try{const t=await(async(e,a)=>{try{return await n()({path:`${l}/rename`,method:"POST",data:{path:e,newName:a}})}catch(e){return console.error("Error renaming item:",e),{success:!1,message:e.message}}})(e,a);t.success?(z(t.message||"Item renamed successfully"),await y()):h(t.message||"Failed to rename item")}catch(e){h("Error renaming item: "+(e.message||"Unknown error"))}finally{_(!1)}},reloadItems:y};return(0,a.createElement)(c.Provider,{value:v},e)},i=()=>(0,t.useContext)(c),d=window.wp.i18n,u=window.wp.components,g=({onCreateFolder:e,onUpload:t,onDelete:r})=>{const{selectedItems:n,navigateToParent:l,reloadItems:s,currentPath:o}=i();return(0,a.createElement)("div",{className:"rz-file-manager__toolbar"},(0,a.createElement)("div",{className:"rz-file-manager__toolbar-left"},(0,a.createElement)(u.Button,{variant:"secondary",onClick:()=>{l()},icon:"arrow-up-alt2",disabled:!o,className:"rz-file-manager__toolbar-button"},(0,d.__)("Parent Directory","rz-file-manager")),(0,a.createElement)(u.Button,{variant:"secondary",onClick:()=>{s()},icon:"update",className:"rz-file-manager__toolbar-button"},(0,d.__)("Refresh","rz-file-manager"))),(0,a.createElement)("div",{className:"rz-file-manager__toolbar-right"},(0,a.createElement)(u.Button,{variant:"primary",onClick:e,icon:"plus",className:"rz-file-manager__toolbar-button"},(0,d.__)("New Folder","rz-file-manager")),(0,a.createElement)(u.Button,{variant:"primary",onClick:t,icon:"upload",className:"rz-file-manager__toolbar-button"},(0,d.__)("Upload","rz-file-manager")),n.length>0&&(0,a.createElement)(u.Button,{variant:"secondary",onClick:r,icon:"trash",isDestructive:!0,className:"rz-file-manager__toolbar-button"},(0,d.__)("Delete","rz-file-manager"))))},f=()=>{const{currentPath:e,navigateTo:t}=i(),r=(()=>{const a=[{name:(0,d.__)("Root","rz-file-manager"),path:""}];if(!e)return a;const t=e.split("/");let r="";for(let e=0;e<t.length;e++)t[e]&&(r+=(r?"/":"")+t[e],a.push({name:t[e],path:r}));return a})();return(0,a.createElement)("div",{className:"rz-file-manager__breadcrumbs"},r.map(((e,r)=>(0,a.createElement)("span",{key:e.path},r>0&&(0,a.createElement)("span",{className:"rz-file-manager__breadcrumbs-separator"},"/"),(0,a.createElement)("a",{href:"#",className:"rz-file-manager__breadcrumbs-item",onClick:a=>{return r=e.path,a.preventDefault(),void t(r);var r}},e.name)))))},_=({item:e,onRename:t})=>{const{navigateTo:r,toggleSelectItem:n,isItemSelected:s,handleDeleteItems:o}=i();return(0,a.createElement)("tr",{className:"rz-file-manager__file-item "+(s(e)?"is-selected":""),onClick:a=>{"directory"===e.type&&r(e.path)},onDoubleClick:()=>{"directory"===e.type&&r(e.path)}},(0,a.createElement)("td",{className:"rz-file-manager__table-checkbox"},(0,a.createElement)("input",{type:"checkbox",checked:s(e),onChange:a=>{a.stopPropagation(),n(e)},onClick:e=>e.stopPropagation()})),(0,a.createElement)("td",{className:"rz-file-manager__table-name"},(0,a.createElement)("span",{className:`dashicons dashicons-${(()=>{if("directory"===e.type)return"portfolio";switch(e.name.split(".").pop().toLowerCase()){case"jpg":case"jpeg":case"png":case"gif":case"svg":return"format-image";case"pdf":return"pdf";case"doc":case"docx":return"media-document";case"xls":case"xlsx":return"media-spreadsheet";case"ppt":case"pptx":return"media-interactive";case"zip":case"rar":case"tar":case"gz":return"archive";case"txt":case"md":return"media-text";case"php":case"js":case"css":case"html":return"editor-code";default:return"media-default"}})()}`,style:{marginRight:"8px",verticalAlign:"middle"}}),e.name),(0,a.createElement)("td",{className:"rz-file-manager__table-size"},"directory"===e.type?"--":((e,a=2)=>{if(0===e)return"0 Bytes";const t=a<0?0:a,r=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,r)).toFixed(t))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][r]})(e.size)),(0,a.createElement)("td",{className:"rz-file-manager__table-modified"},(m=e.modified,new Date(1e3*m).toLocaleString())),(0,a.createElement)("td",{className:"rz-file-manager__table-actions"},"directory"!==e.type&&(0,a.createElement)("a",{href:(c=e.path,`${window.rzFileManager?.restUrl||"/wp-json"+l}/download?path=${encodeURIComponent(c)}&_wpnonce=${window.rzFileManager?.nonce}`),className:"button button-small",onClick:e=>e.stopPropagation(),download:!0},(0,d.__)("Download","rz-file-manager")),(0,a.createElement)(u.Button,{isSmall:!0,onClick:a=>{a.stopPropagation(),t(e)}},(0,d.__)("Rename","rz-file-manager")),(0,a.createElement)(u.Button,{isSmall:!0,isDestructive:!0,onClick:a=>{a.stopPropagation(),n(e),o()}},(0,d.__)("Delete","rz-file-manager"))));var c,m},p=({onRename:e})=>{const{items:t,currentPath:r}=i();return 0===t.length?(0,a.createElement)("div",{className:"rz-file-manager__empty"},(0,a.createElement)("p",null,(0,d.__)("This folder is empty.","rz-file-manager"))):(0,a.createElement)("div",{className:"rz-file-manager__file-list"},(0,a.createElement)("table",{className:"rz-file-manager__table"},(0,a.createElement)("thead",null,(0,a.createElement)("tr",null,(0,a.createElement)("th",{className:"rz-file-manager__table-checkbox"},(0,a.createElement)("span",{className:"screen-reader-text"},(0,d.__)("Select","rz-file-manager"))),(0,a.createElement)("th",{className:"rz-file-manager__table-name"},(0,d.__)("Name","rz-file-manager")),(0,a.createElement)("th",{className:"rz-file-manager__table-size"},(0,d.__)("Size","rz-file-manager")),(0,a.createElement)("th",{className:"rz-file-manager__table-modified"},(0,d.__)("Modified","rz-file-manager")),(0,a.createElement)("th",{className:"rz-file-manager__table-actions"},(0,d.__)("Actions","rz-file-manager")))),(0,a.createElement)("tbody",null,t.map((t=>(0,a.createElement)(_,{key:t.path,item:t,onRename:e}))))))},h=({isOpen:e,onClose:r})=>{const{currentPath:n,handleCreateFolder:l}=i(),[s,o]=(0,t.useState)(""),[c,m]=(0,t.useState)("");return(0,a.createElement)(u.Modal,{title:(0,d.__)("Create New Folder","rz-file-manager"),onRequestClose:r,className:"rz-file-manager__modal"},(0,a.createElement)("form",{onSubmit:e=>{e.preventDefault(),s?/[\\/:*?"<>|]/.test(s)?m((0,d.__)("Folder name contains invalid characters.","rz-file-manager")):(l(s),r()):m((0,d.__)("Please enter a folder name.","rz-file-manager"))}},(0,a.createElement)("div",{className:"rz-file-manager__modal-content"},(0,a.createElement)("p",null,(0,d.__)("Create a new folder in:","rz-file-manager"),(0,a.createElement)("strong",null,n||"/")),(0,a.createElement)(u.TextControl,{label:(0,d.__)("Folder Name","rz-file-manager"),value:s,onChange:e=>{o(e),m("")},placeholder:(0,d.__)("Enter folder name","rz-file-manager"),autoFocus:!0}),c&&(0,a.createElement)("div",{className:"rz-file-manager__modal-error"},c)),(0,a.createElement)("div",{className:"rz-file-manager__modal-footer"},(0,a.createElement)(u.Button,{variant:"secondary",onClick:r},(0,d.__)("Cancel","rz-file-manager")),(0,a.createElement)(u.Button,{variant:"primary",type:"submit"},(0,d.__)("Create Folder","rz-file-manager")))))},E=({isOpen:e,onClose:r,item:n})=>{const{handleRenameItem:l}=i(),[s,o]=(0,t.useState)(""),[c,m]=(0,t.useState)("");return(0,t.useEffect)((()=>{n&&o(n.name)}),[n]),(0,a.createElement)(u.Modal,{title:(0,d.__)("Rename","rz-file-manager"),onRequestClose:r,className:"rz-file-manager__modal"},(0,a.createElement)("form",{onSubmit:e=>{e.preventDefault(),s?/[\\/:*?"<>|]/.test(s)?m((0,d.__)("Name contains invalid characters.","rz-file-manager")):s!==n.name?(l(n.path,s),r()):r():m((0,d.__)("Please enter a name.","rz-file-manager"))}},(0,a.createElement)("div",{className:"rz-file-manager__modal-content"},(0,a.createElement)("p",null,n&&"directory"===n.type?(0,d.__)("Rename folder:","rz-file-manager"):(0,d.__)("Rename file:","rz-file-manager"),(0,a.createElement)("strong",null,n?n.name:"")),(0,a.createElement)(u.TextControl,{label:(0,d.__)("New Name","rz-file-manager"),value:s,onChange:e=>{o(e),m("")},placeholder:(0,d.__)("Enter new name","rz-file-manager"),autoFocus:!0}),c&&(0,a.createElement)("div",{className:"rz-file-manager__modal-error"},c)),(0,a.createElement)("div",{className:"rz-file-manager__modal-footer"},(0,a.createElement)(u.Button,{variant:"secondary",onClick:r},(0,d.__)("Cancel","rz-file-manager")),(0,a.createElement)(u.Button,{variant:"primary",type:"submit"},(0,d.__)("Rename","rz-file-manager")))))},z=({isOpen:e,onClose:t})=>{const{selectedItems:r,handleDeleteItems:n}=i();return(0,a.createElement)(u.Modal,{title:(0,d.__)("Confirm Deletion","rz-file-manager"),onRequestClose:t,className:"rz-file-manager__modal"},(0,a.createElement)("div",{className:"rz-file-manager__modal-content"},(0,a.createElement)("p",null,(()=>{const e=r.filter((e=>"directory"!==e.type)).length,a=r.filter((e=>"directory"===e.type)).length;return e>0&&a>0?(0,d.__)(`Are you sure you want to delete ${e} file(s) and ${a} folder(s)? This action cannot be undone.`,"rz-file-manager"):e>0?(0,d.__)(`Are you sure you want to delete ${e} file(s)? This action cannot be undone.`,"rz-file-manager"):a>0?(0,d.__)(`Are you sure you want to delete ${a} folder(s) and all their contents? This action cannot be undone.`,"rz-file-manager"):(0,d.__)("Are you sure you want to delete the selected items? This action cannot be undone.","rz-file-manager")})()),(0,a.createElement)("ul",{className:"rz-file-manager__delete-list"},r.map((e=>(0,a.createElement)("li",{key:e.path},(0,a.createElement)("strong",null,e.name),"directory"===e.type?` (${(0,d.__)("Folder","rz-file-manager")})`:""))))),(0,a.createElement)("div",{className:"rz-file-manager__modal-footer"},(0,a.createElement)(u.Button,{variant:"secondary",onClick:t},(0,d.__)("Cancel","rz-file-manager")),(0,a.createElement)(u.Button,{variant:"primary",onClick:()=>{n(),t()},isDestructive:!0},(0,d.__)("Delete","rz-file-manager"))))},y=()=>{const{loading:e,error:r,clearError:n,successMessage:l,clearMessages:s}=i(),[o,c]=(0,t.useState)(!1),[m,d]=(0,t.useState)(!1),[_,y]=(0,t.useState)(!1),[w,v]=(0,t.useState)(!1),[b,N]=(0,t.useState)(null);return(0,a.createElement)("div",{className:"rz-file-manager"},r&&(0,a.createElement)("div",{className:"rz-file-manager__error"},(0,a.createElement)("p",null,r),(0,a.createElement)("button",{onClick:s},"×")),l&&(0,a.createElement)("div",{className:"rz-file-manager__success"},(0,a.createElement)("p",null,l),(0,a.createElement)("button",{onClick:s},"×")),(0,a.createElement)(g,{onCreateFolder:()=>{c(!0)},onDelete:()=>{v(!0)}}),(0,a.createElement)(f,null),e?(0,a.createElement)("div",{className:"rz-file-manager__loading"},(0,a.createElement)(u.Spinner,null)):(0,a.createElement)(p,{onRename:e=>{N(e),y(!0)}}),o&&(0,a.createElement)(h,{isOpen:o,onClose:()=>c(!1)}),_&&b&&(0,a.createElement)(E,{isOpen:_,onClose:()=>y(!1),item:b}),w&&(0,a.createElement)(z,{isOpen:w,onClose:()=>v(!1)}))},w=()=>(0,a.createElement)(m,null,(0,a.createElement)("div",{className:"rz-file-manager-app"},(0,a.createElement)(y,null)));document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("rz-file-manager-root");e&&(0,t.render)((0,a.createElement)(m,null,(0,a.createElement)(w,null)),e)}))})();