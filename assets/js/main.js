(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,a=window.wp.element,n={currentPath:"",items:[],selectedItems:[],loading:!1,error:null,successMessage:null,uploadError:null,sortKey:"name",sortDirection:"asc",contextMenu:{visible:!1,x:0,y:0,item:null},editorState:{isOpen:!1,file:null,content:"",isLoading:!1,error:null},renameModalState:{isOpen:!1,item:null},createFolderModalState:{isOpen:!1},deleteModalState:{isOpen:!1,itemsToDelete:[]},uploadModalState:{isOpen:!1},newFileModalState:{isOpen:!1},clipboardState:{action:null,items:[]}},r=window.wp.apiFetch;var l=e.n(r);const o="/rz-file-manager/v1",i=async(e="")=>{try{const t=`${window.rzFileManagerData?.restUrl}list`,a=await fetch(`${t}?path=${encodeURIComponent(e)}`,{method:"GET",credentials:"include",headers:{"X-WP-Nonce":window.rzFileManagerData?.restNonce,"Content-Type":"application/json"}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return await a.json()}catch(e){return{success:!1,message:e.message}}},s=async(e,t)=>{try{const a=new FormData;a.append("file",t),a.append("current_path",e);const n="rz-file-manager/v1";let r=window.rzFileManagerData?.restUrl||`/wp-json/${n}`;r.endsWith("/")&&(r=r.slice(0,-1));const l=`${r}/upload`,o=await fetch(l,{method:"POST",headers:{"X-WP-Nonce":window.rzFileManagerData?.nonce||window.rzFileManagerData?.restNonce},body:a});return await o.json()}catch(e){let t="Network error during upload";if(e.response)try{t=(await e.response.json()).message||e.response.statusText}catch(a){t=e.response.statusText}else e.message&&(t=e.message);return{success:!1,message:t}}},c=async e=>{try{return await l()({path:`${o}/delete`,method:"DELETE",data:{path:e}})}catch(e){return{success:!1,message:e.message}}},d=async(e,t)=>l()({path:o+"/copy",method:"POST",data:{source:e,destination:t}}),m=async(e,t)=>l()({path:o+"/move",method:"POST",data:{source:e,destination:t}}),u=(e,t,a)=>[...e].sort(((e,n)=>{if("directory"===e.type&&"directory"!==n.type)return-1;if("directory"!==e.type&&"directory"===n.type)return 1;let r=0;return"name"===t?r=e.name.localeCompare(n.name,void 0,{numeric:!0,sensitivity:"base"}):"size"===t?r=("directory"===e.type?-1:e.size)-("directory"===n.type?-1:n.size):"modified"===t&&(r=e.modified-n.modified),"asc"===a?r:-1*r})),f=(e,t)=>{const{updateState:n,clearMessages:r,clearUploadError:d}=((e,t)=>{const n=e=>{t((t=>({...t,...e})))},r=(0,a.useCallback)((()=>{n({error:null,successMessage:null})}),[]),l=(0,a.useCallback)((()=>{n({uploadError:null})}),[]);return{updateState:n,clearMessages:r,clearUploadError:l}})(0,t),{loadItems:m,handleCreateFolder:f,handleCreateFile:g,handleRenameItem:p}=((e,t)=>{const{currentPath:n,sortKey:r,sortDirection:s}=e,c=(0,a.useCallback)((async()=>{t({loading:!0,error:null,selectedItems:[]}),t({contextMenu:{visible:!1,x:0,y:0,item:null}});try{const e=await i(n);if(e.success){const a=u(e.items,r,s);t({items:a})}else t({error:e.message||"Failed to load files"})}catch(e){t({error:"Error loading files: "+(e.message||"Unknown error")})}finally{t({loading:!1})}}),[n,r,s,t]);return{loadItems:c,handleCreateFolder:async e=>{t({loading:!0,error:null,successMessage:null,createFolderModalState:{isOpen:!1}});try{const a=await(async(e,t)=>{try{return await l()({path:`${o}/create-folder`,method:"POST",data:{path:e,name:t}})}catch(e){return{success:!1,message:e.message}}})(n,e);a.success?(t({successMessage:a.message||"Folder created successfully"}),await c()):t({error:a.message||"Failed to create folder"})}catch(e){t({error:"Error creating folder: "+(e.message||"Unknown error")})}finally{t({loading:!1})}},handleCreateFile:async e=>{t({loading:!0,error:null,successMessage:null,newFileModalState:{isOpen:!1}});try{const a=await(async(e,t)=>{const a=`${window.rzFileManagerData?.restUrl}create-file`,n=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.rzFileManagerData?.restNonce},body:JSON.stringify({path:e,filename:t})});if(!n.ok){let e=`HTTP error! status: ${n.status} ${n.statusText}`;try{e=(await n.json()).message||e}catch(e){}throw new Error(e)}return n.json()})(n,e);a.success?(t({successMessage:a.message||"File created successfully"}),await c()):t({error:a.message||"Failed to create file"})}catch(e){t({error:"Error creating file: "+(e.message||"Unknown error")})}finally{t({loading:!1})}},handleRenameItem:async(e,a)=>{t({loading:!0,error:null,successMessage:null});try{const n=await(async(e,t)=>{try{return await l()({path:`${o}/rename`,method:"POST",data:{path:e,new_name:t}})}catch(e){return{success:!1,message:e.message}}})(e,a);n.success?(t({successMessage:n.message||"Item renamed successfully"}),await c()):t({error:n.message||"Failed to rename item"})}catch(e){t({error:"Error renaming item: "+(e.message||"Unknown error")})}finally{t({loading:!1})}}}})(e,n),{handleDeleteSelectedItems:h,handleDeleteItem:y}=((e,t,n)=>{const{deleteModalState:r}=e;return{handleDeleteSelectedItems:(0,a.useCallback)((async()=>{const e=r.itemsToDelete;if(!e||0===e.length)return console.error("No items selected for deletion in modal state."),void t({deleteModalState:{isOpen:!1,itemsToDelete:[]}});t({loading:!0,error:null,successMessage:null,deleteModalState:{isOpen:!1,itemsToDelete:[]}});try{const a=e.map((e=>c(e.path))),r=await Promise.allSettled(a),l=r.filter((e=>"rejected"===e.status)),o=r.filter((e=>"fulfilled"===e.status&&e.value.success));if(l.length>0){console.error("Failed deletions:",l);const e=l.map((e=>e.reason?.message||"Failed to delete an item."));t({error:`Failed to delete ${l.length} item(s). Errors: ${e.join(", ")}`})}o.length>0&&t({successMessage:`${o.length} item(s) deleted successfully.`}),await n()}catch(e){console.error("Deletion failed:",e),t({error:e.message||"An unexpected error occurred during deletion."})}finally{t({loading:!1})}}),[r.itemsToDelete,t,n]),handleDeleteItem:async()=>{if(!r.itemsToDelete||0===r.itemsToDelete.length)return;const e=r.itemsToDelete[0];t({loading:!0,error:null,successMessage:null,deleteModalState:{isOpen:!1,itemsToDelete:[]}});try{const a=await c(e.path);a.success?(t({successMessage:a.message||"Item deleted successfully"}),await n()):t({error:`Failed to delete ${e.name}: ${a.message||"Unknown error"}`})}catch(e){t({error:"Error deleting item: "+(e.message||"Unknown error")})}finally{t({loading:!1})}}}})(e,n,m),{handleUploadFiles:_}=((e,t,a)=>{const{currentPath:n}=e;return{handleUploadFiles:async e=>{if(!e||0===e.length)return t({error:"No files selected for upload."}),setTimeout((()=>t({error:null})),3e3),void t({uploadModalState:{isOpen:!1}});t({loading:!0,error:null,successMessage:null,uploadError:null});let r=!0,l="";try{for(let a=0;a<e.length;a++){const l=e[a],o=await s(n,l);o.success||(t({error:`Failed to upload ${l.name}: ${o.message||"Unknown error"}`,uploadError:o.message||"An unknown error occurred."}),r=!1)}r&&(l=e.length>1?"Files uploaded successfully":"File uploaded successfully",t({successMessage:l})),await a()}catch(e){t({error:"Error uploading files: "+(e.message||"Unknown error"),uploadError:e.message||"A critical error occurred during upload."}),r=!1}finally{t({loading:!1}),r&&t({uploadModalState:{isOpen:!1}})}}}})(e,n,m),{openFileEditor:E,closeFileEditor:w,saveEditedFile:v,handleEditorContentChange:b}=((e,t)=>{const a=()=>{t({editorState:{isOpen:!1,file:null,content:"",isLoading:!1,error:null}})};return{openFileEditor:async e=>{if("file"===e.type){t({editorState:{isOpen:!0,file:e,content:"",isLoading:!0,error:null}});try{const a=await(async e=>{const t=`${o}/get-content?path=${encodeURIComponent(e)}`;try{return await l()({path:t,method:"GET"})}catch(e){return{success:!1,message:e.message}}})(e.path);if(!a.success)throw new Error(a.message||"Failed to load file content.");t({editorState:{isOpen:!0,file:e,content:a.content,isLoading:!1,error:null}})}catch(a){t({editorState:{isOpen:!0,file:e,content:"",isLoading:!1,error:a.message}})}}},closeFileEditor:a,saveEditedFile:async()=>{const{editorState:n}=e;if(n.file){t({editorState:{...n,isLoading:!0,error:null}});try{const e=await(async(e,t)=>{try{return await l()({path:`${o}/save-content`,method:"POST",data:{path:e,content:t}})}catch(e){return{success:!1,message:e.message}}})(n.file.path,n.content);if(!e.success)throw new Error(e.message||"Failed to save file content.");a(),t({successMessage:e.message||"File saved successfully!"})}catch(e){t({editorState:{...n,isLoading:!1,error:e.message}})}}},handleEditorContentChange:a=>{const{editorState:n}=e;t({editorState:{...n,content:a}})}}})(e,n);return{loadItems:m,handleCreateFolder:f,handleCreateFile:g,handleRenameItem:p,handleDeleteSelectedItems:h,handleDeleteItem:y,handleUploadFiles:_,openFileEditor:E,closeFileEditor:w,saveEditedFile:v,handleEditorContentChange:b,clearMessages:r,clearUploadError:d}},g=(0,a.createContext)(),p=({children:e})=>{const[r,l]=(0,a.useState)(n),o=f(r,l),i=((e,t)=>{const n=(0,a.useCallback)((e=>{var a;a={currentPath:e,selectedItems:[]},t((e=>({...e,...a})))}),[]),r=(0,a.useCallback)((()=>{const{currentPath:t}=e;if(!t)return;const a=t.split("/");a.pop();const r=a.join("/");n(r)}),[e.currentPath]);return{navigateTo:n,navigateToParent:r}})(r,l),s=((e,t)=>{const{items:n,selectedItems:r}=e,l=e=>{t((t=>({...t,...e})))};return{toggleSelectItem:(0,a.useCallback)(((e,t)=>{const a=t.shiftKey,o=(t.ctrlKey||t.metaKey,r.some((t=>t.path===e.path)));let i=[...r];if(a&&r.length>0){const t=r[r.length-1],a=n.findIndex((e=>e.path===t.path)),l=n.findIndex((t=>t.path===e.path)),o=Math.min(a,l),s=Math.max(a,l),c=n.slice(o,s+1);i=[...i,...c]}else i=o?i.filter((t=>t.path!==e.path)):[...i,e];l({selectedItems:i})}),[n,r]),toggleSelectAll:(0,a.useCallback)((()=>{const e=n.length>0&&r.length===n.length;l(e?{selectedItems:[]}:{selectedItems:[...n]})}),[n,r]),isItemSelected:(0,a.useCallback)((e=>r.some((t=>t.path===e.path))),[r]),clearSelection:(0,a.useCallback)((()=>{l({selectedItems:[]})}),[]),areAllItemsSelected:n.length>0&&r.length===n.length}})(r,l),c=((e,t)=>{const n=e=>{t((t=>({...t,...e})))};return{showContextMenu:(0,a.useCallback)(((e,t)=>{n({contextMenu:{visible:!0,x:t.pageX,y:t.pageY,item:e}})}),[]),hideContextMenu:(0,a.useCallback)((()=>{n({contextMenu:{visible:!1,x:0,y:0,item:null}})}),[]),openRenameModal:(0,a.useCallback)((e=>{n({renameModalState:{isOpen:!0,item:e}})}),[]),closeRenameModal:(0,a.useCallback)((()=>{n({renameModalState:{isOpen:!1,item:null}})}),[]),openCreateFolderModal:(0,a.useCallback)((()=>{n({createFolderModalState:{isOpen:!0}})}),[]),closeCreateFolderModal:(0,a.useCallback)((()=>{n({createFolderModalState:{isOpen:!1}})}),[]),openDeleteModal:(0,a.useCallback)((e=>{e&&0!==e.length?n({deleteModalState:{isOpen:!0,itemsToDelete:e}}):console.warn("openDeleteModal called with no items.")}),[]),closeDeleteModal:(0,a.useCallback)((()=>{n({deleteModalState:{isOpen:!1,itemsToDelete:[]}})}),[]),openUploadModal:(0,a.useCallback)((()=>{n({uploadModalState:{isOpen:!0}})}),[]),closeUploadModal:(0,a.useCallback)((()=>{n({uploadModalState:{isOpen:!1}})}),[]),openNewFileModal:(0,a.useCallback)((()=>{n({newFileModalState:{isOpen:!0}})}),[]),closeNewFileModal:(0,a.useCallback)((()=>{n({newFileModalState:{isOpen:!1}})}),[])}})(0,l),p=((e,t,n)=>{const{currentPath:r,clipboardState:l}=e,o=e=>{t((t=>({...t,...e})))};return{handleCopyItems:(0,a.useCallback)((e=>{e&&0!==e.length&&o({clipboardState:{action:"copy",items:e},successMessage:`${e.length} item(s) added to clipboard for copying.`,error:null})}),[]),handleCutItems:(0,a.useCallback)((e=>{e&&0!==e.length&&o({clipboardState:{action:"cut",items:e},successMessage:`${e.length} item(s) added to clipboard for cutting.`,error:null})}),[]),handlePasteItems:(0,a.useCallback)((async()=>{const{action:e,items:t}=l;if(!e||!t||0===t.length)return void o({error:"Clipboard is empty or action is invalid."});o({loading:!0,error:null,successMessage:null});const a=r,i="copy"===e?d:m,s="copy"===e?"copied":"moved",c=t.map((e=>{const t=e.path,n="/"===a?"/"+e.name:a+"/"+e.name;return i(t,n)})),u=await Promise.allSettled(c),f=u.filter((e=>"rejected"===e.status||"fulfilled"===e.status&&!e.value.success)),g=u.filter((e=>"fulfilled"===e.status&&e.value.success));if(f.length>0){console.error(`Failed ${e} operations:`,f);const t=f.map((t=>{const a=t.reason||t.value;return a?.message||`Failed to ${e} an item.`}));o({error:`${f.length} item(s) failed to ${e}. Error: ${t[0]}`})}g.length>0&&(o({successMessage:`${g.length} item(s) ${s} successfully to ${a}.`}),"cut"===e&&o({clipboardState:{action:null,items:[]}}),await n()),o({loading:!1})}),[l,r,n])}})(r,l,o.loadItems),h=((e,t)=>{const{sortKey:n,sortDirection:r}=e;return{setSort:(0,a.useCallback)((a=>{const l=n===a&&"asc"===r?"desc":"asc",o=u(e.items,a,l);var i;i={sortKey:a,sortDirection:l,items:o},t((e=>({...e,...i})))}),[e.items,n,r])}})(r,l),y=((e,t,n)=>{const{currentPath:r}=e,l=e=>{t((t=>({...t,...e})))};return{handleZipItem:(0,a.useCallback)((async e=>{console.log("Attempting to zip:",e),l({loading:!0,error:null,successMessage:null});try{await(async e=>{const t=`${window.rzFileManagerData?.restUrl}zip`;try{const a=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.rzFileManagerData?.restNonce},body:JSON.stringify({path:e})}),n=await a.json();if(!a.ok){const e=n.message||`HTTP error! status: ${a.status}`;throw{code:n.code||"zip_failed",message:e,data:n.data||null}}return n}catch(e){throw console.error("Error zipping item:",e),e}})(e),await n(),l({successMessage:"Item zipped successfully."})}catch(e){console.error("Zip failed:",e),l({error:e.message||"Failed to zip item. Please ensure the server has permissions and the PHP Zip extension is enabled."})}finally{l({loading:!1})}}),[r,n]),handleUnzipItem:(0,a.useCallback)((async(e,t=!1)=>{console.log(`Attempting to unzip: ${e}, Unzip Here: ${t}`),l({loading:!0,error:null,successMessage:null});try{await(async(e,t=!1)=>{const a=`${window.rzFileManagerData?.restUrl}unzip`;try{const n=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.rzFileManagerData?.restNonce},body:JSON.stringify({path:e,unzipHere:t})}),r=await n.json();if(!n.ok){const e=r.message||`HTTP error! status: ${n.status}`;throw{code:r.code||"unzip_failed",message:e,data:r.data||null}}return r}catch(e){throw console.error("Error unzipping item:",e),e}})(e,t),await n(),l({successMessage:"Archive extracted successfully."})}catch(e){console.error("Unzip failed:",e);let t="Failed to unzip archive.";"unzip_destination_exists"===e.code?t=e.message||"Cannot extract: A file or folder with the target name already exists.":e.message&&(t=e.message),l({error:t})}finally{l({loading:!1})}}),[r,n])}})(r,l,o.loadItems);(0,a.useEffect)((()=>{o.loadItems()}),[r.currentPath]),(0,a.useEffect)((()=>{if(r.successMessage){const e=setTimeout((()=>{l((e=>({...e,successMessage:null})))}),3e3);return()=>clearTimeout(e)}}),[r.successMessage]),(0,a.useEffect)((()=>{o.loadItems()}),[r.currentPath,r.sortKey,r.sortDirection]);const _=(0,a.useMemo)((()=>({...r,...o,...i,...s,...c,...p,...h,...y,areAllItemsSelected:r.items.length>0&&r.selectedItems.length===r.items.length})),[r,o,i,s,c,p,h,y]);return(0,t.createElement)(g.Provider,{value:_},e)},h=g,y=()=>(0,a.useContext)(h),_=window.wp.i18n,E=window.wp.components,w=()=>{const{selectedItems:e,navigateToParent:a,loadItems:n,currentPath:r,openCreateFolderModal:l,openUploadModal:o,openNewFileModal:i,loading:s}=y();return e.length,(0,t.createElement)("div",{className:"rz-file-manager__toolbar"},(0,t.createElement)("div",{className:"rz-file-manager__toolbar-left"},(0,t.createElement)(E.Button,{variant:"secondary",onClick:()=>{a()},icon:"arrow-up-alt2",disabled:!r,className:"rz-file-manager__toolbar-button"},(0,_.__)("Parent Directory","rz-file-manager")),(0,t.createElement)(E.Button,{variant:"secondary",onClick:()=>{n()},icon:"update",className:"rz-file-manager__toolbar-button"},(0,_.__)("Refresh","rz-file-manager"))),(0,t.createElement)("div",{className:"rz-file-manager__toolbar-right"},(0,t.createElement)(E.Button,{variant:"primary",onClick:i,icon:"plus",disabled:s,className:"rz-file-manager__toolbar-button"},(0,_.__)("New File","rz-file-manager")),(0,t.createElement)(E.Button,{variant:"primary",onClick:l,icon:"plus",className:"rz-file-manager__toolbar-button"},(0,_.__)("New Folder","rz-file-manager")),(0,t.createElement)(E.Button,{variant:"primary",onClick:o,icon:"upload",className:"rz-file-manager__toolbar-button"},(0,_.__)("Upload","rz-file-manager"))))},v=()=>{const{currentPath:e,navigateTo:a}=y(),n=(()=>{const t=[{name:(0,_.__)("Root","rz-file-manager"),path:""}];if(!e)return t;const a=e.split("/");let n="";for(let e=0;e<a.length;e++)a[e]&&(n+=(n?"/":"")+a[e],t.push({name:a[e],path:n}));return t})();return(0,t.createElement)("div",{className:"rz-file-manager__breadcrumbs"},n.map(((e,n)=>(0,t.createElement)("span",{key:e.path},n>0&&(0,t.createElement)("span",{className:"rz-file-manager__breadcrumbs-separator"},"/"),(0,t.createElement)("a",{href:"#",className:"rz-file-manager__breadcrumbs-item",onClick:t=>{return n=e.path,t.preventDefault(),void a(n);var n}},e.name)))))},b=({item:e,onRename:a})=>{const{navigateTo:n,toggleSelectItem:r,isItemSelected:l,showContextMenu:o,handleDeleteItems:i,openFileEditor:s}=y();return(0,t.createElement)("tr",{className:"rz-file-manager__file-item "+(l(e)?"is-selected":""),onClick:e=>{},onDoubleClick:()=>{"directory"===e.type?n(e.path):"file"===e.type&&s(e)},onContextMenu:t=>{t.preventDefault(),o(e,t)}},(0,t.createElement)("td",{className:"rz-file-manager__table-checkbox"},(0,t.createElement)("input",{type:"checkbox",checked:l(e),onChange:t=>{t.stopPropagation(),r(e,t)},"aria-label":`Select ${e.name}`})),(0,t.createElement)("td",{className:"rz-file-manager__table-name"},(0,t.createElement)("span",{className:`dashicons dashicons-${(()=>{if("directory"===e.type)return"portfolio";switch(e.name.split(".").pop().toLowerCase()){case"jpg":case"jpeg":case"png":case"gif":case"bmp":return"format-image";case"pdf":return"media-document";case"doc":case"docx":return"media-text";case"xls":case"xlsx":return"media-spreadsheet";case"ppt":case"pptx":return"media-interactive";case"zip":case"rar":case"7z":return"portfolio";case"txt":case"md":return"text-page";default:return"media-default"}})()}`,style:{marginRight:"8px",verticalAlign:"middle",color:"directory"===e.type?"#f0ad4e":"#5bc0de"}}),e.name),(0,t.createElement)("td",{className:"rz-file-manager__table-size"},"directory"===e.type?"-":((e,t=2)=>{if(0===e||"number"!=typeof e)return"0 Bytes";const a=t<0?0:t,n=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],r=Math.floor(Math.log(e)/Math.log(1024)),l=r<n.length?r:n.length-1;return parseFloat((e/Math.pow(1024,l)).toFixed(a))+" "+n[l]})(e.size)),(0,t.createElement)("td",{className:"rz-file-manager__table-modified"},(e=>{if(!e||"number"!=typeof e)return"-";try{const t=new Date(1e3*e);return isNaN(t.getTime())?"Invalid Date":t.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}catch(e){return"Error"}})(e.modified)))},z=({onRename:e})=>{const{items:a,sortKey:n,sortDirection:r,setSort:l,toggleSelectAll:o,areAllItemsSelected:i,selectedItems:s}=y();if(0===a.length)return(0,t.createElement)("div",{className:"rz-file-manager__empty"},(0,t.createElement)("span",{className:"dashicons dashicons-portfolio"}),(0,t.createElement)("p",null,(0,_.__)("This folder is empty.","rz-file-manager")),(0,t.createElement)("p",{className:"rz-file-manager__empty-hint"},(0,_.__)("Upload files or create a new folder to get started.","rz-file-manager")));const c=e=>{l(e)},d=e=>{if(n!==e)return null;const a="asc"===r?"dashicons dashicons-arrow-up-alt2":"dashicons dashicons-arrow-down-alt2";return(0,t.createElement)("span",{className:a,style:{marginLeft:"5px"}})};return(0,t.createElement)("div",{className:"rz-file-manager__file-list"},(0,t.createElement)("table",{className:"rz-file-manager__table"},(0,t.createElement)("thead",{className:"rz-file-manager__table-head"},(0,t.createElement)("tr",{onClick:e=>e.stopPropagation()}," ",(0,t.createElement)("th",{className:"rz-file-manager__table-checkbox"},(0,t.createElement)("input",{type:"checkbox","aria-label":(0,_.__)("Select all items","rz-file-manager"),checked:i,onChange:o,disabled:0===a.length})),(0,t.createElement)("th",{className:"rz-file-manager__table-name",onClick:()=>c("name")},(0,_.__)("Name","rz-file-manager"),d("name")),(0,t.createElement)("th",{className:"rz-file-manager__table-size",onClick:()=>c("size")},(0,_.__)("Size","rz-file-manager"),d("size")),(0,t.createElement)("th",{className:"rz-file-manager__table-modified",onClick:()=>c("modified")},(0,_.__)("Modified","rz-file-manager"),d("modified")))),(0,t.createElement)("tbody",null,a.map((a=>(0,t.createElement)(b,{key:a.path,item:a,onRename:e}))))))},C=(0,t.memo)((({folder:e,onFolderClick:n,currentPath:r,level:l=0,isOpen:o,onToggle:s})=>{const[c,d]=(0,a.useState)([]),[m,u]=(0,a.useState)(!1),[f,g]=(0,a.useState)(!1),p=r===e.path,h=(0,a.useCallback)((async()=>{if(!(f&&0===c.length||f&&c.length>0)){u(!0);try{const t=await i(e.path);if(t.success&&t.items){const e=t.items.filter((e=>"folder"===e.type||"directory"===e.type));d(e)}g(!0)}catch(e){console.error("Error loading folder children:",e)}finally{u(!1)}}}),[e.path,f,c.length]);(0,a.useEffect)((()=>{""!==e.path||f||h()}),[e.path,f,h]),(0,a.useEffect)((()=>{o&&!f&&h()}),[o,f,h]);const y=(0,a.useCallback)((()=>{n(e.path),o||s(e.path)}),[n,e.path,o,s]);return(0,t.createElement)("div",{className:"rz-folder-tree-item"},(0,t.createElement)("div",{className:"rz-folder-tree-item__header "+(p?"is-active":""),style:{paddingLeft:16*l+"px"}},(0,t.createElement)("button",{className:"rz-folder-tree-item__toggle",onClick:()=>s(e.path),"aria-label":o?(0,_.__)("Collapse folder","rz-file-manager"):(0,_.__)("Expand folder","rz-file-manager")},(0,t.createElement)("span",{className:"dashicons "+(o?"dashicons-arrow-down-alt2":"dashicons-arrow-right-alt2")})),(0,t.createElement)("div",{className:"rz-folder-tree-item__name",onClick:y},(0,t.createElement)("span",{className:"dashicons dashicons-portfolio",style:{color:"#f0ad4e"}}),(0,t.createElement)("span",{className:"rz-folder-tree-item__label"},e.name))),o&&(0,t.createElement)("div",{className:"rz-folder-tree-item__children"},m?(0,t.createElement)("div",{className:"rz-folder-tree-item__loading"},(0,t.createElement)(E.Spinner,null)):c.length>0?c.map((e=>(0,t.createElement)(C,{key:e.path,folder:e,onFolderClick:n,currentPath:r,level:l+1,isOpen:!!s.openFolders[e.path],onToggle:s}))):f?(0,t.createElement)("div",{className:"rz-folder-tree-item__empty",style:{paddingLeft:16*(l+1)+"px"}},(0,_.__)("No subfolders","rz-file-manager")):null))})),M=()=>{const{currentPath:e,navigateTo:n}=y(),[r,l]=(0,a.useState)([]),[o,s]=(0,a.useState)(!0),[c,d]=(0,a.useState)({"":!0});(0,a.useEffect)((()=>{(async()=>{s(!0);try{const e=await i("");if(e.success&&e.items){const e={name:(0,_.__)("Root","rz-file-manager"),path:"",type:"folder"};l([e])}}catch(e){console.error("Error loading root folders:",e)}finally{s(!1)}})()}),[]),(0,a.useEffect)((()=>{const t=function(e){const t=[];let a=e;for(;a;){t.unshift(a);const e=a.lastIndexOf("/");if(e<=0)break;a=a.slice(0,e)}return t.includes("")||t.unshift(""),t}(e);d((e=>{const a={...e};return t.forEach((e=>{a[e]=!0})),a}))}),[e]);const m=(0,a.useCallback)((e=>{d((t=>({...t,[e]:!t[e]})))}),[]);m.openFolders=c;const u=e=>{n(e)};return(0,t.createElement)("div",{className:"rz-file-manager__folder-tree",id:"folder-tree-container"},(0,t.createElement)("h3",{className:"rz-file-manager__sidebar-title"},(0,_.__)("Folders","rz-file-manager")),o?(0,t.createElement)("div",{className:"rz-file-manager__folder-tree-loading"},(0,t.createElement)(E.Spinner,null)):(0,t.createElement)("div",{className:"rz-folder-tree"},r.map((a=>(0,t.createElement)(C,{key:a.path,folder:a,onFolderClick:u,currentPath:e,level:0,isOpen:!!c[a.path],onToggle:m})))))},N=({isOpen:e,onClose:n})=>{const{currentPath:r,handleCreateFolder:l}=y(),[o,i]=(0,a.useState)(""),[s,c]=(0,a.useState)("");return(0,t.createElement)(E.Modal,{title:(0,_.__)("Create New Folder","rz-file-manager"),onRequestClose:n,className:"rz-file-manager__modal"},(0,t.createElement)("form",{onSubmit:e=>{e.preventDefault(),o?/[\\/:*?"<>|]/.test(o)?c((0,_.__)("Folder name contains invalid characters.","rz-file-manager")):(l(o),n()):c((0,_.__)("Please enter a folder name.","rz-file-manager"))}},(0,t.createElement)("div",{className:"rz-file-manager__modal-content"},(0,t.createElement)("p",null,(0,_.__)("Create a new folder in:","rz-file-manager"),(0,t.createElement)("strong",null,r||"/")),(0,t.createElement)(E.TextControl,{label:(0,_.__)("Folder Name","rz-file-manager"),value:o,__nextHasNoMarginBottom:!0,onChange:e=>{i(e),c("")},placeholder:(0,_.__)("Enter folder name","rz-file-manager"),autoFocus:!0}),s&&(0,t.createElement)("div",{className:"rz-file-manager__modal-error"},s)),(0,t.createElement)("div",{className:"rz-file-manager__modal-footer"},(0,t.createElement)(E.Button,{variant:"secondary",onClick:n},(0,_.__)("Cancel","rz-file-manager")),(0,t.createElement)(E.Button,{variant:"primary",type:"submit"},(0,_.__)("Create Folder","rz-file-manager")))))},O=({isOpen:e,onClose:n,item:r})=>{const{handleRenameItem:l}=y(),[o,i]=(0,a.useState)(""),[s,c]=(0,a.useState)("");return(0,a.useEffect)((()=>{r&&i(r.name)}),[r]),(0,t.createElement)(E.Modal,{title:(0,_.__)("Rename","rz-file-manager"),onRequestClose:n,className:"rz-file-manager__modal"},(0,t.createElement)("form",{onSubmit:e=>{e.preventDefault(),o?/[\\/:*?"<>|]/.test(o)?c((0,_.__)("Name contains invalid characters.","rz-file-manager")):o!==r.name?(l(r.path,o),n()):n():c((0,_.__)("Please enter a name.","rz-file-manager"))}},(0,t.createElement)("div",{className:"rz-file-manager__modal-content"},(0,t.createElement)("p",null,r&&"directory"===r.type?(0,_.__)("Rename folder:","rz-file-manager"):(0,_.__)("Rename file:","rz-file-manager"),(0,t.createElement)("strong",null,r?r.name:"")),(0,t.createElement)(E.TextControl,{label:(0,_.__)("New Name","rz-file-manager"),value:o,onChange:e=>{i(e),c("")},placeholder:(0,_.__)("Enter new name","rz-file-manager"),autoFocus:!0}),s&&(0,t.createElement)("div",{className:"rz-file-manager__modal-error"},s)),(0,t.createElement)("div",{className:"rz-file-manager__modal-footer"},(0,t.createElement)(E.Button,{variant:"secondary",onClick:n},(0,_.__)("Cancel","rz-file-manager")),(0,t.createElement)(E.Button,{variant:"primary",type:"submit"},(0,_.__)("Rename","rz-file-manager")))))},S=()=>{const{deleteModalState:e,closeDeleteModal:a,handleDeleteSelectedItems:n,loading:r}=y();if(!e.isOpen||!e.itemsToDelete)return null;const l=e.itemsToDelete.length,o=1===l?(0,_.sprintf)((0,_.__)('Are you sure you want to delete "%s"?',"rz-file-manager"),e.itemsToDelete[0]?.name):(0,_.sprintf)((0,_.__)("Are you sure you want to delete %d selected items?","rz-file-manager"),l);return(0,t.createElement)(E.Modal,{title:(0,_.__)("Confirm Deletion","rz-file-manager"),onRequestClose:a,className:"rz-file-manager__modal rz-file-manager__delete-modal",shouldCloseOnClickOutside:!0,shouldCloseOnEsc:!0},(0,t.createElement)("div",{className:"rz-file-manager__modal-content"},(0,t.createElement)("p",null,o),(0,t.createElement)("p",{className:"rz-fm-delete-warning"},(0,_.__)("This action cannot be undone.","rz-file-manager"))),(0,t.createElement)("div",{className:"rz-file-manager__modal-footer"},(0,t.createElement)(E.Button,{variant:"secondary",onClick:a,disabled:r},(0,_.__)("Cancel","rz-file-manager")),(0,t.createElement)(E.Button,{variant:"primary",onClick:()=>{n()},isDestructive:!0,disabled:r},r?(0,_.__)("Deleting...","rz-file-manager"):(0,_.__)("Delete","rz-file-manager"))))},k=({isOpen:e,onClose:n})=>{const{currentPath:r,handleUploadFiles:l,uploadError:o,clearUploadError:i}=y(),s=(0,a.useRef)(null),[c,d]=(0,a.useState)([]),[m,u]=(0,a.useState)({}),[f,g]=(0,a.useState)({});(0,a.useEffect)((()=>{e&&(d([]),i())}),[e,i]);const p=()=>{i(),n()};return(0,t.createElement)(E.Modal,{title:(0,_.__)("Upload Files","rz-file-manager"),onRequestClose:p,className:"rz-file-manager__modal rz-file-manager__upload-modal"},o&&(0,t.createElement)("div",{className:"rz-fm-upload-error"},"Error: ",o),(0,t.createElement)("form",{onSubmit:e=>{e.preventDefault(),0!==c.length&&l(c,r,{onProgress:(e,t)=>{u((a=>({...a,[e.name]:t})))},onError:(e,t)=>{g((a=>({...a,[e.name]:t})))},onComplete:()=>{n()}})}},(0,t.createElement)("div",{className:"rz-file-manager__modal-content"},(0,t.createElement)("p",null,(0,_.__)("Upload files to:","rz-file-manager"),(0,t.createElement)("strong",null,r||"/")),(0,t.createElement)("div",{className:"rz-file-manager__upload-area"},(0,t.createElement)("input",{type:"file",ref:s,onChange:e=>{const t=Array.from(e.target.files);d(t),u({}),g({}),i()},multiple:!0,style:{display:"none"}}),(0,t.createElement)(E.Button,{variant:"secondary",onClick:()=>{s.current.click()},className:"rz-file-manager__browse-button"},(0,_.__)("Browse Files","rz-file-manager")),(0,t.createElement)("p",{className:"rz-file-manager__upload-info"},c.length>0?(0,_.__)(`${c.length} file(s) selected`,"rz-file-manager"):(0,_.__)("No files selected","rz-file-manager"))),c.length>0&&(0,t.createElement)("div",{className:"rz-file-manager__selected-files"},(0,t.createElement)("h3",null,(0,_.__)("Selected Files","rz-file-manager")),(0,t.createElement)("ul",{className:"rz-file-manager__file-list"},c.map(((e,a)=>(0,t.createElement)("li",{key:a,className:"rz-file-manager__file-item"},(0,t.createElement)("div",{className:"rz-file-manager__file-info"},(0,t.createElement)("span",{className:"rz-file-manager__file-name"},e.name),(0,t.createElement)("span",{className:"rz-file-manager__file-size"},"(",(e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB"][t]})(e.size),")")),void 0!==m[e.name]&&(0,t.createElement)(E.ProgressBar,{value:m[e.name],className:"rz-file-manager__progress"}),f[e.name]&&(0,t.createElement)("div",{className:"rz-file-manager__file-error"},f[e.name]))))))),(0,t.createElement)("div",{className:"rz-file-manager__modal-footer"},(0,t.createElement)(E.Button,{variant:"secondary",onClick:p},(0,_.__)("Cancel","rz-file-manager")),(0,t.createElement)(E.Button,{variant:"primary",type:"submit",disabled:0===c.length},(0,_.__)("Upload","rz-file-manager")))))},F=()=>{const{newFileModalState:e,closeNewFileModal:n,handleCreateFile:r,loading:l,error:o,setError:i}=y(),[s,c]=(0,a.useState)(""),[d,m]=(0,a.useState)("");return(0,a.useEffect)((()=>{e.isOpen?(c(""),m(""),o&&i(null)):(c(""),m(""))}),[e.isOpen]),e.isOpen?(0,t.createElement)(E.Modal,{title:(0,_.__)("Create New File","rz-file-manager"),onRequestClose:n,className:"rz-file-manager__modal rz-file-manager__new-file-modal",shouldCloseOnClickOutside:!l,shouldCloseOnEsc:!l},(0,t.createElement)("form",{onSubmit:e=>{if(e.preventDefault(),m(""),console.log("[NewFileModal] handleSubmit called"),!s.trim())return console.log("[NewFileModal] Validation failed: Filename empty"),void m((0,_.__)("Filename cannot be empty.","rz-file-manager"));const t=/[\\\\/:*?"<>|]/g;return console.log("[NewFileModal] Checking filename against regex:",t),t.test(s)?(console.log("[NewFileModal] Validation failed: Invalid characters"),void m((0,_.__)('Filename contains invalid characters (\\\\ / : * ? " < > |).',"rz-file-manager"))):(console.log("[NewFileModal] Checking for extension"),!s.includes(".")||s.endsWith(".")?(console.log("[NewFileModal] Validation failed: Missing or invalid extension"),void m((0,_.__)("Please include a file extension (e.g., .txt, .html).","rz-file-manager"))):(console.log("[NewFileModal] Validation passed. Calling handleCreateFile with:",s.trim()),void r(s.trim())))}},(0,t.createElement)("div",{className:"rz-file-manager__modal-content"},(0,t.createElement)(E.TextControl,{label:(0,_.__)("Filename (including extension)","rz-file-manager"),value:s,onChange:c,placeholder:(0,_.__)("e.g., document.txt, image.jpg","rz-file-manager"),help:d||(0,_.__)("Enter the name for the new file, including its extension.","rz-file-manager"),className:d?"has-error":"",autoFocus:!0,disabled:l,__nextHasNoMarginBottom:!0})),(0,t.createElement)("div",{className:"rz-file-manager__modal-footer"},(0,t.createElement)(E.Button,{variant:"secondary",onClick:n,disabled:l},(0,_.__)("Cancel","rz-file-manager")),(0,t.createElement)(E.Button,{variant:"primary",type:"submit",isBusy:l,disabled:l||!s.trim()||d},l?(0,_.__)("Creating...","rz-file-manager"):(0,_.__)("Create File","rz-file-manager"))))):null};function x(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function j(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function P(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?j(Object(a),!0).forEach((function(t){x(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):j(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function I(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function T(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function R(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?T(Object(a),!0).forEach((function(t){I(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):T(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function $(e){return function t(){for(var a=this,n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return r.length>=e.length?e.apply(this,r):function(){for(var e=arguments.length,n=new Array(e),l=0;l<e;l++)n[l]=arguments[l];return t.apply(a,[].concat(r,n))}}}function U(e){return{}.toString.call(e).includes("Object")}function B(e){return"function"==typeof e}var L=$((function(e,t){throw new Error(e[t]||e.default)}))({initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"}),A=function(e,t){return U(t)||L("changeType"),Object.keys(t).some((function(t){return a=e,n=t,!Object.prototype.hasOwnProperty.call(a,n);var a,n}))&&L("changeField"),t},V=function(e){B(e)||L("selectorType")},q=function(e){B(e)||U(e)||L("handlerType"),U(e)&&Object.values(e).some((function(e){return!B(e)}))&&L("handlersType")},H=function(e){var t;e||L("initialIsRequired"),U(e)||L("initialType"),t=e,Object.keys(t).length||L("initialContent")};function K(e,t){return B(t)?t(e.current):t}function W(e,t){return e.current=R(R({},e.current),t),t}function Z(e,t,a){return B(t)?t(e.current):Object.keys(a).forEach((function(a){var n;return null===(n=t[a])||void 0===n?void 0:n.call(t,e.current[a])})),a}const X=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};H(e),q(t);var a={current:e},n=$(Z)(a,t),r=$(W)(a),l=$(A)(e),o=$(K)(a);return[function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e};return V(e),e(a.current)},function(e){!function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return function(e){return t.reduceRight((function(e,t){return t(e)}),e)}}(n,r,l,o)(e)}]};var G,J={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:"Deprecation warning!\n    You are using deprecated way of configuration.\n\n    Instead of using\n      monaco.config({ urls: { monacoBase: '...' } })\n    use\n      monaco.config({ paths: { vs: '...' } })\n\n    For more please check the link https://github.com/suren-atoyan/monaco-loader#config\n  "},Y=(G=function(e,t){throw new Error(e[t]||e.default)},function e(){for(var t=this,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return n.length>=G.length?G.apply(this,n):function(){for(var a=arguments.length,r=new Array(a),l=0;l<a;l++)r[l]=arguments[l];return e.apply(t,[].concat(n,r))}})(J);const Q={config:function(e){return e||Y("configIsRequired"),t=e,{}.toString.call(t).includes("Object")||Y("configType"),e.urls?(console.warn(J.deprecation),{paths:{vs:e.urls.monacoBase}}):e;var t}},ee=function e(t,a){return Object.keys(a).forEach((function(n){a[n]instanceof Object&&t[n]&&Object.assign(a[n],e(t[n],a[n]))})),P(P({},t),a)};var te={type:"cancelation",msg:"operation is manually canceled"};const ae=function(e){var t=!1,a=new Promise((function(a,n){e.then((function(e){return t?n(te):a(e)})),e.catch(n)}));return a.cancel=function(){return t=!0},a};var ne,re=function(e){if(Array.isArray(e))return e}(ne=X({config:{paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs"}},isInitialized:!1,resolve:null,reject:null,monaco:null}))||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var t=[],_n=!0,a=!1,n=void 0;try{for(var r,l=e[Symbol.iterator]();!(_n=(r=l.next()).done)&&(t.push(r.value),2!==t.length);_n=!0);}catch(e){a=!0,n=e}finally{try{_n||null==l.return||l.return()}finally{if(a)throw n}}return t}}(ne)||function(e){if(e){if("string"==typeof e)return D(e,2);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?D(e,2):void 0}}(ne)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),le=re[0],oe=re[1];function ie(e){return document.body.appendChild(e)}function se(e){var t,a,n=le((function(e){return{config:e.config,reject:e.reject}})),r=(t="".concat(n.config.paths.vs,"/loader.js"),a=document.createElement("script"),t&&(a.src=t),a);return r.onload=function(){return e()},r.onerror=n.reject,r}function ce(){var e=le((function(e){return{config:e.config,resolve:e.resolve,reject:e.reject}})),t=window.require;t.config(e.config),t(["vs/editor/editor.main"],(function(t){de(t),e.resolve(t)}),(function(t){e.reject(t)}))}function de(e){le().monaco||oe({monaco:e})}var me=new Promise((function(e,t){return oe({resolve:e,reject:t})})),ue={config:function(e){var t=Q.config(e),a=t.monaco,n=function(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}(t,["monaco"]);oe((function(e){return{config:ee(e.config,n),monaco:a}}))},init:function(){var e=le((function(e){return{monaco:e.monaco,isInitialized:e.isInitialized,resolve:e.resolve}}));if(!e.isInitialized){if(oe({isInitialized:!0}),e.monaco)return e.resolve(e.monaco),ae(me);if(window.monaco&&window.monaco.editor)return de(window.monaco),e.resolve(window.monaco),ae(me);!function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return function(e){return t.reduceRight((function(e,t){return t(e)}),e)}}(ie,se)(ce)}return ae(me)},__getMonacoInstance:function(){return le((function(e){return e.monaco}))}};const fe=ue;var ge={display:"flex",position:"relative",textAlign:"initial"},pe={width:"100%"},he={display:"none"},ye={container:{display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"}},_e=function({children:e}){return t.createElement("div",{style:ye.container},e)},Ee=(0,t.memo)((function({width:e,height:a,isEditorReady:n,loading:r,_ref:l,className:o,wrapperProps:i}){return t.createElement("section",{style:{...ge,width:e,height:a},...i},!n&&t.createElement(_e,null,r),t.createElement("div",{ref:l,style:{...pe,...!n&&he},className:o}))})),we=function(e){(0,t.useEffect)(e,[])},ve=function(e,a,n=!0){let r=(0,t.useRef)(!0);(0,t.useEffect)(r.current||!n?()=>{r.current=!1}:e,a)};function be(){}function ze(e,t,a,n){return function(e,t){return e.editor.getModel(Ce(e,t))}(e,n)||function(e,t,a,n){return e.editor.createModel(t,a,n?Ce(e,n):void 0)}(e,t,a,n)}function Ce(e,t){return e.Uri.parse(t)}(0,t.memo)((function({original:e,modified:a,language:n,originalLanguage:r,modifiedLanguage:l,originalModelPath:o,modifiedModelPath:i,keepCurrentOriginalModel:s=!1,keepCurrentModifiedModel:c=!1,theme:d="light",loading:m="Loading...",options:u={},height:f="100%",width:g="100%",className:p,wrapperProps:h={},beforeMount:y=be,onMount:_=be}){let[E,w]=(0,t.useState)(!1),[v,b]=(0,t.useState)(!0),z=(0,t.useRef)(null),C=(0,t.useRef)(null),M=(0,t.useRef)(null),N=(0,t.useRef)(_),O=(0,t.useRef)(y),S=(0,t.useRef)(!1);we((()=>{let e=fe.init();return e.then((e=>(C.current=e)&&b(!1))).catch((e=>"cancelation"!==e?.type&&console.error("Monaco initialization: error:",e))),()=>z.current?function(){let e=z.current?.getModel();s||e?.original?.dispose(),c||e?.modified?.dispose(),z.current?.dispose()}():e.cancel()})),ve((()=>{if(z.current&&C.current){let t=z.current.getOriginalEditor(),a=ze(C.current,e||"",r||n||"text",o||"");a!==t.getModel()&&t.setModel(a)}}),[o],E),ve((()=>{if(z.current&&C.current){let e=z.current.getModifiedEditor(),t=ze(C.current,a||"",l||n||"text",i||"");t!==e.getModel()&&e.setModel(t)}}),[i],E),ve((()=>{let e=z.current.getModifiedEditor();e.getOption(C.current.editor.EditorOption.readOnly)?e.setValue(a||""):a!==e.getValue()&&(e.executeEdits("",[{range:e.getModel().getFullModelRange(),text:a||"",forceMoveMarkers:!0}]),e.pushUndoStop())}),[a],E),ve((()=>{z.current?.getModel()?.original.setValue(e||"")}),[e],E),ve((()=>{let{original:e,modified:t}=z.current.getModel();C.current.editor.setModelLanguage(e,r||n||"text"),C.current.editor.setModelLanguage(t,l||n||"text")}),[n,r,l],E),ve((()=>{C.current?.editor.setTheme(d)}),[d],E),ve((()=>{z.current?.updateOptions(u)}),[u],E);let k=(0,t.useCallback)((()=>{if(!C.current)return;O.current(C.current);let t=ze(C.current,e||"",r||n||"text",o||""),s=ze(C.current,a||"",l||n||"text",i||"");z.current?.setModel({original:t,modified:s})}),[n,a,l,e,r,o,i]),F=(0,t.useCallback)((()=>{!S.current&&M.current&&(z.current=C.current.editor.createDiffEditor(M.current,{automaticLayout:!0,...u}),k(),C.current?.editor.setTheme(d),w(!0),S.current=!0)}),[u,d,k]);return(0,t.useEffect)((()=>{E&&N.current(z.current,C.current)}),[E]),(0,t.useEffect)((()=>{!v&&!E&&F()}),[v,E,F]),t.createElement(Ee,{width:g,height:f,isEditorReady:E,loading:m,_ref:M,className:p,wrapperProps:h})}));var Me=new Map,Ne=(0,t.memo)((function({defaultValue:e,defaultLanguage:a,defaultPath:n,value:r,language:l,path:o,theme:i="light",line:s,loading:c="Loading...",options:d={},overrideServices:m={},saveViewState:u=!0,keepCurrentModel:f=!1,width:g="100%",height:p="100%",className:h,wrapperProps:y={},beforeMount:_=be,onMount:E=be,onChange:w,onValidate:v=be}){let[b,z]=(0,t.useState)(!1),[C,M]=(0,t.useState)(!0),N=(0,t.useRef)(null),O=(0,t.useRef)(null),S=(0,t.useRef)(null),k=(0,t.useRef)(E),F=(0,t.useRef)(_),x=(0,t.useRef)(),j=(0,t.useRef)(r),P=function(e){let a=(0,t.useRef)();return(0,t.useEffect)((()=>{a.current=e}),[e]),a.current}(o),D=(0,t.useRef)(!1),I=(0,t.useRef)(!1);we((()=>{let e=fe.init();return e.then((e=>(N.current=e)&&M(!1))).catch((e=>"cancelation"!==e?.type&&console.error("Monaco initialization: error:",e))),()=>O.current?(x.current?.dispose(),f?u&&Me.set(o,O.current.saveViewState()):O.current.getModel()?.dispose(),void O.current.dispose()):e.cancel()})),ve((()=>{let t=ze(N.current,e||r||"",a||l||"",o||n||"");t!==O.current?.getModel()&&(u&&Me.set(P,O.current?.saveViewState()),O.current?.setModel(t),u&&O.current?.restoreViewState(Me.get(o)))}),[o],b),ve((()=>{O.current?.updateOptions(d)}),[d],b),ve((()=>{!O.current||void 0===r||(O.current.getOption(N.current.editor.EditorOption.readOnly)?O.current.setValue(r):r!==O.current.getValue()&&(I.current=!0,O.current.executeEdits("",[{range:O.current.getModel().getFullModelRange(),text:r,forceMoveMarkers:!0}]),O.current.pushUndoStop(),I.current=!1))}),[r],b),ve((()=>{let e=O.current?.getModel();e&&l&&N.current?.editor.setModelLanguage(e,l)}),[l],b),ve((()=>{void 0!==s&&O.current?.revealLine(s)}),[s],b),ve((()=>{N.current?.editor.setTheme(i)}),[i],b);let T=(0,t.useCallback)((()=>{if(S.current&&N.current&&!D.current){F.current(N.current);let t=o||n,c=ze(N.current,r||e||"",a||l||"",t||"");O.current=N.current?.editor.create(S.current,{model:c,automaticLayout:!0,...d},m),u&&O.current.restoreViewState(Me.get(t)),N.current.editor.setTheme(i),void 0!==s&&O.current.revealLine(s),z(!0),D.current=!0}}),[e,a,n,r,l,o,d,m,u,i,s]);return(0,t.useEffect)((()=>{b&&k.current(O.current,N.current)}),[b]),(0,t.useEffect)((()=>{!C&&!b&&T()}),[C,b,T]),j.current=r,(0,t.useEffect)((()=>{b&&w&&(x.current?.dispose(),x.current=O.current?.onDidChangeModelContent((e=>{I.current||w(O.current.getValue(),e)})))}),[b,w]),(0,t.useEffect)((()=>{if(b){let e=N.current.editor.onDidChangeMarkers((e=>{let t=O.current.getModel()?.uri;if(t&&e.find((e=>e.path===t.path))){let e=N.current.editor.getModelMarkers({resource:t});v?.(e)}}));return()=>{e?.dispose()}}return()=>{}}),[b,v]),t.createElement(Ee,{width:g,height:p,isEditorReady:b,loading:c,_ref:S,className:h,wrapperProps:y})}));const Oe=()=>{const{editorState:e,closeFileEditor:a,saveEditedFile:n,handleEditorContentChange:r}=y();if(!e.isOpen)return null;const{file:l,content:o,isLoading:i,error:s}=e,c=(e=>{if(!e)return"plaintext";const t=e.split(".").pop()?.toLowerCase();switch(t){case"js":case"jsx":return"javascript";case"ts":case"tsx":return"typescript";case"css":return"css";case"scss":return"scss";case"less":return"less";case"html":return"html";case"json":return"json";case"php":return"php";case"md":return"markdown";case"yaml":case"yml":return"yaml";case"xml":return"xml";case"py":return"python";case"sql":return"sql";default:return"plaintext"}})(l?.name);return(0,t.createElement)(E.Modal,{title:l?`${(0,_.__)("Edit File","rz-file-manager")}: ${l.name}`:(0,_.__)("Edit File","rz-file-manager"),onRequestClose:a,className:"rz-file-manager-editor-modal",shouldCloseOnClickOutside:!0,isDismissible:!i},i&&!o&&(0,t.createElement)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px"}},(0,t.createElement)(E.Spinner,null)),!i&&s&&(0,t.createElement)("div",{className:"rz-file-manager-editor-modal__error",style:{color:"red",marginBottom:"1em"}},(0,t.createElement)("p",null,(0,t.createElement)("strong",null,(0,_.__)("Error","rz-file-manager"),":")," ",s)),(!i||o)&&!s&&(0,t.createElement)(Ne,{height:"50vh",language:c,value:o,theme:"vs-light",options:{lineNumbers:"on",minimap:{enabled:!0,side:"right",size:"proportional",showSlider:"mouseover",renderCharacters:!1,maxColumn:120},wordWrap:"on",scrollBeyondLastLine:!1,readOnly:i},onChange:r,onMount:(e,t)=>{}}),(0,t.createElement)("div",{className:"rz-file-manager-editor-modal__actions",style:{marginTop:"1em",display:"flex",justifyContent:"flex-end"}},(0,t.createElement)(E.Button,{isSecondary:!0,onClick:a,disabled:i,style:{marginRight:"8px"}},(0,_.__)("Cancel","rz-file-manager")),(0,t.createElement)(E.Button,{isPrimary:!0,onClick:n,isBusy:i,disabled:i||!!s},(0,_.__)("Save Changes","rz-file-manager"))))},Se=window.ReactDOM,ke=(e,t)=>e.some((e=>e.path===t.path))?e:[t],Fe=()=>{const{contextMenu:e,hideContextMenu:a,openFileEditor:n,openRenameModal:r,openDeleteModal:l,handleRenameItem:o,handleCreateFolder:i,handleCreateFile:s,selectedItems:c,handleCopyItems:d,handleMoveItems:m,handleDownloadItem:u,handleDownloadZip:f,handleZipItem:g,handleUnzipItem:p,clipboardState:h,handleCutItems:E,handlePasteItems:w}=y(),v=(0,t.useRef)(null);if((0,t.useEffect)((()=>{const t=e=>{v.current&&!v.current.contains(e.target)&&a()};return e.visible?document.addEventListener("mousedown",t):document.removeEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}}),[e.visible,a]),!e.visible||!e.item)return null;const b={position:"absolute",top:`${e.y}px`,left:`${e.x}px`,zIndex:1e3},z=(0,t.createElement)("div",{ref:v,className:"rz-file-manager-context-menu",style:b},(0,t.createElement)("ul",null,"file"===e.item.type&&(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>{e.item&&"file"===e.item.type&&n(e.item),a()}},(0,t.createElement)("span",{className:"dashicons dashicons-edit",style:{marginRight:"5px"}})," ",(0,_.__)("Edit","rz-file-manager"))),(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>{if(!e.item)return;let t;"file"===e.item.type?t=(e=>{const t=window.rzFileManagerData?.ajaxUrl,a=window.rzFileManagerData?.ajaxNonce;return`${t}?action=rz_fm_download_item&path=${e}&_wpnonce=${a}`})(e.item.path):"directory"===e.item.type&&(t=(e=>{const t=window.rzFileManagerData?.ajaxUrl,a=window.rzFileManagerData?.ajaxNonce;return`${t}?action=rz_fm_download_zip&path=${e}&_wpnonce=${a}`})(e.item.path)),t&&(window.location.href=t),a()}},(0,t.createElement)("span",{className:"dashicons dashicons-download",style:{marginRight:"5px"}})," ",(0,_.__)("Download","rz-file-manager"))),(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>{e.item&&r(e.item),a()}},(0,t.createElement)("span",{className:"dashicons dashicons-tag",style:{marginRight:"5px"}})," Rename")),"file"===e.item.type&&(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>{e.item?(console.log("Zip clicked for:",e.item.path),g(e.item.path)):console.warn("Zip called with invalid selection",e.item),a()}},(0,t.createElement)("span",{className:"dashicons dashicons-archive",style:{marginRight:"5px"}})," ",(0,_.__)("Compress to .zip","rz-file-manager"))),e.item.name.toLowerCase().endsWith(".zip")&&"file"===e.item.type&&(0,t.createElement)(t.Fragment,null,(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>{e.item&&e.item.name.toLowerCase().endsWith(".zip")&&"file"===e.item.type?(console.log("Unzip clicked for:",e.item.path),p(e.item.path)):console.warn("Unzip called with invalid selection",e.item),a()}},(0,t.createElement)("span",{className:"dashicons dashicons-unlock",style:{marginRight:"5px"}}),`Extract to folder "${e.item.name.replace(/\.zip$/i,"")}"`)),(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>{e.item&&e.item.name.toLowerCase().endsWith(".zip")&&"file"===e.item.type?(console.log("Unzip Here clicked for:",e.item.path),p(e.item.path,!0)):console.warn("Unzip Here called with invalid selection",e.item),a()}},(0,t.createElement)("span",{className:"dashicons dashicons-unlock",style:{marginRight:"5px"}})," Extract here"))),e.item&&(0,t.createElement)(t.Fragment,null,(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>{const t=ke(c,e.item);d(t),a()}},(0,t.createElement)("span",{className:"dashicons dashicons-admin-page",style:{marginRight:"5px"}})," ",(0,_.__)("Copy","rz-file-manager"))),(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>{const t=ke(c,e.item);E(t),a()}},(0,t.createElement)("span",{className:"dashicons dashicons-hammer",style:{marginRight:"5px"}})," ",(0,_.__)("Cut","rz-file-manager"))),(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>{const t=c.some((t=>t.path===e.item.path))?c:[e.item];console.log("Delete clicked. Items to target:",t),l(t),a()},style:{color:"red"}},(0,t.createElement)("span",{className:"dashicons dashicons-trash",style:{marginRight:"5px"}})," ",(0,_.__)("Delete","rz-file-manager")))),(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>{w(),a()},disabled:!h.action},(0,t.createElement)("span",{className:"dashicons dashicons-editor-paste-text",style:{marginRight:"5px"}})," ",(0,_.__)("Paste","rz-file-manager")))));return(0,Se.createPortal)(z,document.body)},xe=()=>{const{loading:e,error:a,successMessage:n,clearMessages:r,renameModalState:l,openRenameModal:o,closeRenameModal:i,createFolderModalState:s,openCreateFolderModal:c,closeCreateFolderModal:d,deleteModalState:m,openDeleteModal:u,closeDeleteModal:f,hideContextMenu:g,uploadModalState:p,openUploadModal:h,closeUploadModal:_}=y();return(0,t.createElement)("div",{className:"rz-file-manager",onClick:()=>{g()}},a&&(0,t.createElement)("div",{className:"rz-file-manager__error"},(0,t.createElement)("p",null,a),(0,t.createElement)("button",{onClick:r},"×")),n&&(0,t.createElement)("div",{className:"rz-file-manager__success"},(0,t.createElement)("p",null,n),(0,t.createElement)("button",{onClick:r},"×")),(0,t.createElement)(w,{onCreateFolder:c,onDelete:u,onUpload:h}),(0,t.createElement)("div",{className:"rz-file-manager__content"},(0,t.createElement)("div",{className:"rz-file-manager__sidebar"},(0,t.createElement)(M,null)),(0,t.createElement)("div",{className:"rz-file-manager__main"},(0,t.createElement)(v,null),e?(0,t.createElement)("div",{className:"rz-file-manager__loading"},(0,t.createElement)(E.Spinner,null)):(0,t.createElement)(z,null))),s.isOpen&&(0,t.createElement)(N,{isOpen:s.isOpen,onClose:d}),l.isOpen&&(0,t.createElement)(O,{isOpen:l.isOpen,onClose:i,item:l.item}),m.isOpen&&(0,t.createElement)(S,{isOpen:m.isOpen,onClose:f}),p.isOpen&&(0,t.createElement)(k,{isOpen:p.isOpen,onClose:_}),(0,t.createElement)(Fe,null),(0,t.createElement)(Oe,null),(0,t.createElement)(F,null))},je=()=>(0,t.createElement)(p,null,(0,t.createElement)("div",{className:"rz-file-manager-app"},(0,t.createElement)(xe,null)));document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("rz-file-manager-root");e&&(0,a.render)((0,t.createElement)(p,null,(0,t.createElement)(je,null)),e)}))})();