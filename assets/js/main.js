(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,a=window.wp.element,r=window.wp.apiFetch;var n=e.n(r);const l="/rz-file-manager/v1",s=async(e,t)=>{try{const a=new FormData;a.append("file",t),a.append("path",e);const r=`${window.rzFileManager?.restUrl||"/wp-json"+l}/upload`,n=await fetch(r,{method:"POST",headers:{"X-WP-Nonce":window.rzFileManager?.nonce},body:a});return await n.json()}catch(e){return console.error("Error uploading file:",e),{success:!1,message:e.message}}},o=async e=>{try{return await n()({path:`${l}/delete`,method:"DELETE",data:{path:e}})}catch(e){return console.error("Error deleting item:",e),{success:!1,message:e.message}}},c=(0,a.createContext)(),i=({children:e})=>{const[r,i]=(0,a.useState)(""),[m,d]=(0,a.useState)([]),[u,f]=(0,a.useState)([]),[g,p]=(0,a.useState)(!1),[_,h]=(0,a.useState)(null),[E,y]=(0,a.useState)(null),[z,w]=(0,a.useState)("name"),[v,b]=(0,a.useState)("asc"),[C,N]=(0,a.useState)({visible:!1,x:0,y:0,item:null}),k=async()=>{p(!0),h(null);try{const e=await(async(e="")=>{try{console.log("fetchFiles called with path:",e),console.log("rzFileManager object:",window.rzFileManager);const t=`${window.rzFileManager?.restUrl}list`;console.log("Attempting standard fetch with URL:",t);const a=await fetch(`${t}?path=${encodeURIComponent(e)}`,{method:"GET",credentials:"include",headers:{"X-WP-Nonce":window.rzFileManager?.nonce,"Content-Type":"application/json"}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return await a.json()}catch(e){return console.error("Error in fetchFiles (standard fetch):",e),{success:!1,message:e.message}}})(r);if(e.success){const t=x(e.items,z,v);d(t)}else h(e.message||"Failed to load files")}catch(e){h("Error loading files: "+(e.message||"Unknown error"))}finally{p(!1)}},x=(e,t,a)=>[...e].sort(((e,r)=>{if("directory"===e.type&&"directory"!==r.type)return-1;if("directory"!==e.type&&"directory"===r.type)return 1;let n=0;return"name"===t?n=e.name.localeCompare(r.name,void 0,{numeric:!0,sensitivity:"base"}):"size"===t?n=("directory"===e.type?-1:e.size)-("directory"===r.type?-1:r.size):"modified"===t&&(n=e.modified-r.modified),"asc"===a?n:-1*n})),S=e=>{i(e),f([])},F=(0,a.useCallback)(((e,t)=>{t.preventDefault(),N({visible:!0,x:t.pageX,y:t.pageY,item:e})}),[]),M=(0,a.useCallback)((()=>{C.visible&&N({...C,visible:!1,item:null})}),[C]);(0,a.useEffect)((()=>{k()}),[r,z,v]),(0,a.useEffect)((()=>{if(E){const e=setTimeout((()=>{y(null)}),3e3);return()=>clearTimeout(e)}}),[E]);const D={currentPath:r,items:m,selectedItems:u,loading:g,error:_,successMessage:E,navigateTo:S,navigateToParent:()=>{if(!r)return;const e=r.split("/");e.pop();const t=e.join("/");S(t)},toggleSelectItem:e=>{f((t=>t.some((t=>t.path===e.path))?t.filter((t=>t.path!==e.path)):[...t,e]))},isItemSelected:e=>u.some((t=>t.path===e.path)),clearSelection:()=>{f([])},clearMessages:()=>{h(null),y(null)},handleCreateFolder:async e=>{p(!0),h(null);try{const t=await(async(e,t)=>{try{return await n()({path:`${l}/create-folder`,method:"POST",data:{path:e,name:t}})}catch(e){return console.error("Error creating folder:",e),{success:!1,message:e.message}}})(r,e);t.success?(y(t.message||"Folder created successfully"),await k()):h(t.message||"Failed to create folder")}catch(e){h("Error creating folder: "+(e.message||"Unknown error"))}finally{p(!1)}},handleUploadFiles:async e=>{p(!0),h(null);try{for(let t=0;t<e.length;t++){const a=e[t],n=await s(r,a);if(!n.success){h(`Failed to upload ${a.name}: ${n.message||"Unknown error"}`);break}}y("Files uploaded successfully"),await k()}catch(e){h("Error uploading files: "+(e.message||"Unknown error"))}finally{p(!1)}},handleDeleteItems:async()=>{if(0!==u.length){p(!0),h(null);try{for(const e of u){const t=await o(e.path);if(!t.success){h(`Failed to delete ${e.name}: ${t.message||"Unknown error"}`);break}}y("Items deleted successfully"),f([]),await k()}catch(e){h("Error deleting items: "+(e.message||"Unknown error"))}finally{p(!1)}}},handleRenameItem:async(e,t)=>{p(!0),h(null);try{const a=await(async(e,t)=>{try{return await n()({path:`${l}/rename`,method:"POST",data:{path:e,newName:t}})}catch(e){return console.error("Error renaming item:",e),{success:!1,message:e.message}}})(e,t);a.success?(y(a.message||"Item renamed successfully"),await k()):h(a.message||"Failed to rename item")}catch(e){h("Error renaming item: "+(e.message||"Unknown error"))}finally{p(!1)}},reloadItems:k,sortKey:z,sortDirection:v,setSort:e=>{const t=z===e&&"asc"===v?"desc":"asc";w(e),b(t),d((a=>x(a,e,t)))},contextMenu:C,showContextMenu:F,hideContextMenu:M};return(0,t.createElement)(c.Provider,{value:D},e)},m=()=>(0,a.useContext)(c),d=window.wp.i18n,u=window.wp.components,f=({onCreateFolder:e,onUpload:a,onDelete:r})=>{const{selectedItems:n,navigateToParent:l,reloadItems:s,currentPath:o}=m();return(0,t.createElement)("div",{className:"rz-file-manager__toolbar"},(0,t.createElement)("div",{className:"rz-file-manager__toolbar-left"},(0,t.createElement)(u.Button,{variant:"secondary",onClick:()=>{l()},icon:"arrow-up-alt2",disabled:!o,className:"rz-file-manager__toolbar-button"},(0,d.__)("Parent Directory","rz-file-manager")),(0,t.createElement)(u.Button,{variant:"secondary",onClick:()=>{s()},icon:"update",className:"rz-file-manager__toolbar-button"},(0,d.__)("Refresh","rz-file-manager"))),(0,t.createElement)("div",{className:"rz-file-manager__toolbar-right"},(0,t.createElement)(u.Button,{variant:"primary",onClick:e,icon:"plus",className:"rz-file-manager__toolbar-button"},(0,d.__)("New Folder","rz-file-manager")),(0,t.createElement)(u.Button,{variant:"primary",onClick:a,icon:"upload",className:"rz-file-manager__toolbar-button"},(0,d.__)("Upload","rz-file-manager")),n.length>0&&(0,t.createElement)(u.Button,{variant:"secondary",onClick:r,icon:"trash",isDestructive:!0,className:"rz-file-manager__toolbar-button"},(0,d.__)("Delete","rz-file-manager"))))},g=()=>{const{currentPath:e,navigateTo:a}=m(),r=(()=>{const t=[{name:(0,d.__)("Root","rz-file-manager"),path:""}];if(!e)return t;const a=e.split("/");let r="";for(let e=0;e<a.length;e++)a[e]&&(r+=(r?"/":"")+a[e],t.push({name:a[e],path:r}));return t})();return(0,t.createElement)("div",{className:"rz-file-manager__breadcrumbs"},r.map(((e,r)=>(0,t.createElement)("span",{key:e.path},r>0&&(0,t.createElement)("span",{className:"rz-file-manager__breadcrumbs-separator"},"/"),(0,t.createElement)("a",{href:"#",className:"rz-file-manager__breadcrumbs-item",onClick:t=>{return r=e.path,t.preventDefault(),void a(r);var r}},e.name)))))},p=({item:e,onRename:a})=>{const{navigateTo:r,toggleSelectItem:n,isItemSelected:l,showContextMenu:s,handleDeleteItems:o}=m();return(0,t.createElement)("tr",{className:"rz-file-manager__file-item "+(l(e)?"is-selected":""),onClick:t=>{const a=t.shiftKey,r=t.ctrlKey||t.metaKey;n(e,a,r)},onDoubleClick:()=>{"directory"===e.type&&r(e.path)},onContextMenu:t=>{t.preventDefault(),s(e,t)}},(0,t.createElement)("td",{className:"rz-file-manager__table-checkbox"},(0,t.createElement)("input",{type:"checkbox",checked:l(e),onChange:t=>{t.stopPropagation(),t.stopPropagation(),n(e)},"aria-label":`Select ${e.name}`})),(0,t.createElement)("td",{className:"rz-file-manager__table-name"},(0,t.createElement)("span",{className:`dashicons dashicons-${(()=>{if("directory"===e.type)return"portfolio";switch(e.name.split(".").pop().toLowerCase()){case"jpg":case"jpeg":case"png":case"gif":case"bmp":return"format-image";case"pdf":return"media-document";case"doc":case"docx":return"media-text";case"xls":case"xlsx":return"media-spreadsheet";case"ppt":case"pptx":return"media-interactive";case"zip":case"rar":case"7z":return"portfolio";case"txt":case"md":return"text-page";default:return"media-default"}})()}`,style:{marginRight:"8px",verticalAlign:"middle"}}),e.name),(0,t.createElement)("td",{className:"rz-file-manager__table-size"},"directory"===e.type?"-":((e,t=2)=>{if(0===e||"number"!=typeof e)return"0 Bytes";const a=t<0?0:t,r=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],n=Math.floor(Math.log(e)/Math.log(1024)),l=n<r.length?n:r.length-1;return parseFloat((e/Math.pow(1024,l)).toFixed(a))+" "+r[l]})(e.size)),(0,t.createElement)("td",{className:"rz-file-manager__table-modified"},(e=>{if(!e||"number"!=typeof e)return"-";try{const t=new Date(1e3*e);return isNaN(t.getTime())?"Invalid Date":t.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}catch(e){return console.error("Error formatting date:",e),"Error"}})(e.modified)))},_=({onRename:e})=>{const{items:a,currentPath:r,sortKey:n,sortDirection:l,setSort:s}=m();if(0===a.length)return(0,t.createElement)("div",{className:"rz-file-manager__empty"},(0,t.createElement)("p",null,(0,d.__)("This folder is empty.","rz-file-manager")));const o=e=>{s(e)},c=e=>{if(n!==e)return null;const a="asc"===l?"dashicons dashicons-arrow-up-alt2":"dashicons dashicons-arrow-down-alt2";return(0,t.createElement)("span",{className:a,style:{marginLeft:"5px"}})};return(0,t.createElement)("div",{className:"rz-file-manager__file-list"},(0,t.createElement)("table",{className:"rz-file-manager__table"},(0,t.createElement)("thead",{className:"rz-file-manager__table-head"},(0,t.createElement)("tr",{onClick:e=>e.stopPropagation()}," ",(0,t.createElement)("th",{className:"rz-file-manager__table-checkbox"},(0,t.createElement)("span",{className:"screen-reader-text"},(0,d.__)("Select","rz-file-manager"))),(0,t.createElement)("th",{className:"rz-file-manager__table-name",onClick:()=>o("name")},(0,d.__)("Name","rz-file-manager"),c("name")),(0,t.createElement)("th",{className:"rz-file-manager__table-size",onClick:()=>o("size")},(0,d.__)("Size","rz-file-manager"),c("size")),(0,t.createElement)("th",{className:"rz-file-manager__table-modified",onClick:()=>o("modified")},(0,d.__)("Modified","rz-file-manager"),c("modified")),(0,t.createElement)("th",{className:"rz-file-manager__table-actions"},(0,d.__)("Actions","rz-file-manager")))),(0,t.createElement)("tbody",null,a.map((a=>(0,t.createElement)(p,{key:a.path,item:a,onRename:e}))))))},h=({isOpen:e,onClose:r})=>{const{currentPath:n,handleCreateFolder:l}=m(),[s,o]=(0,a.useState)(""),[c,i]=(0,a.useState)("");return(0,t.createElement)(u.Modal,{title:(0,d.__)("Create New Folder","rz-file-manager"),onRequestClose:r,className:"rz-file-manager__modal"},(0,t.createElement)("form",{onSubmit:e=>{e.preventDefault(),s?/[\\/:*?"<>|]/.test(s)?i((0,d.__)("Folder name contains invalid characters.","rz-file-manager")):(l(s),r()):i((0,d.__)("Please enter a folder name.","rz-file-manager"))}},(0,t.createElement)("div",{className:"rz-file-manager__modal-content"},(0,t.createElement)("p",null,(0,d.__)("Create a new folder in:","rz-file-manager"),(0,t.createElement)("strong",null,n||"/")),(0,t.createElement)(u.TextControl,{label:(0,d.__)("Folder Name","rz-file-manager"),value:s,onChange:e=>{o(e),i("")},placeholder:(0,d.__)("Enter folder name","rz-file-manager"),autoFocus:!0}),c&&(0,t.createElement)("div",{className:"rz-file-manager__modal-error"},c)),(0,t.createElement)("div",{className:"rz-file-manager__modal-footer"},(0,t.createElement)(u.Button,{variant:"secondary",onClick:r},(0,d.__)("Cancel","rz-file-manager")),(0,t.createElement)(u.Button,{variant:"primary",type:"submit"},(0,d.__)("Create Folder","rz-file-manager")))))},E=({isOpen:e,onClose:r,item:n})=>{const{handleRenameItem:l}=m(),[s,o]=(0,a.useState)(""),[c,i]=(0,a.useState)("");return(0,a.useEffect)((()=>{n&&o(n.name)}),[n]),(0,t.createElement)(u.Modal,{title:(0,d.__)("Rename","rz-file-manager"),onRequestClose:r,className:"rz-file-manager__modal"},(0,t.createElement)("form",{onSubmit:e=>{e.preventDefault(),s?/[\\/:*?"<>|]/.test(s)?i((0,d.__)("Name contains invalid characters.","rz-file-manager")):s!==n.name?(l(n.path,s),r()):r():i((0,d.__)("Please enter a name.","rz-file-manager"))}},(0,t.createElement)("div",{className:"rz-file-manager__modal-content"},(0,t.createElement)("p",null,n&&"directory"===n.type?(0,d.__)("Rename folder:","rz-file-manager"):(0,d.__)("Rename file:","rz-file-manager"),(0,t.createElement)("strong",null,n?n.name:"")),(0,t.createElement)(u.TextControl,{label:(0,d.__)("New Name","rz-file-manager"),value:s,onChange:e=>{o(e),i("")},placeholder:(0,d.__)("Enter new name","rz-file-manager"),autoFocus:!0}),c&&(0,t.createElement)("div",{className:"rz-file-manager__modal-error"},c)),(0,t.createElement)("div",{className:"rz-file-manager__modal-footer"},(0,t.createElement)(u.Button,{variant:"secondary",onClick:r},(0,d.__)("Cancel","rz-file-manager")),(0,t.createElement)(u.Button,{variant:"primary",type:"submit"},(0,d.__)("Rename","rz-file-manager")))))},y=({isOpen:e,onClose:a})=>{const{selectedItems:r,handleDeleteItems:n}=m();return(0,t.createElement)(u.Modal,{title:(0,d.__)("Confirm Deletion","rz-file-manager"),onRequestClose:a,className:"rz-file-manager__modal"},(0,t.createElement)("div",{className:"rz-file-manager__modal-content"},(0,t.createElement)("p",null,(()=>{const e=r.filter((e=>"directory"!==e.type)).length,t=r.filter((e=>"directory"===e.type)).length;return e>0&&t>0?(0,d.__)(`Are you sure you want to delete ${e} file(s) and ${t} folder(s)? This action cannot be undone.`,"rz-file-manager"):e>0?(0,d.__)(`Are you sure you want to delete ${e} file(s)? This action cannot be undone.`,"rz-file-manager"):t>0?(0,d.__)(`Are you sure you want to delete ${t} folder(s) and all their contents? This action cannot be undone.`,"rz-file-manager"):(0,d.__)("Are you sure you want to delete the selected items? This action cannot be undone.","rz-file-manager")})()),(0,t.createElement)("ul",{className:"rz-file-manager__delete-list"},r.map((e=>(0,t.createElement)("li",{key:e.path},(0,t.createElement)("strong",null,e.name),"directory"===e.type?` (${(0,d.__)("Folder","rz-file-manager")})`:""))))),(0,t.createElement)("div",{className:"rz-file-manager__modal-footer"},(0,t.createElement)(u.Button,{variant:"secondary",onClick:a},(0,d.__)("Cancel","rz-file-manager")),(0,t.createElement)(u.Button,{variant:"primary",onClick:()=>{n(),a()},isDestructive:!0},(0,d.__)("Delete","rz-file-manager"))))},z=()=>{const{contextMenu:e,hideContextMenu:a}=m(),r=(0,t.useRef)(null);if((0,t.useEffect)((()=>{const t=e=>{r.current&&!r.current.contains(e.target)&&a()};return e.visible?document.addEventListener("mousedown",t):document.removeEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}}),[e.visible,a]),!e.visible||!e.item)return null;const n=t=>{console.log(`${t} clicked for:`,e.item.name),a()},l={position:"absolute",top:`${e.y}px`,left:`${e.x}px`,zIndex:1e3};return(0,t.createElement)("div",{ref:r,className:"rz-file-manager-context-menu",style:l},(0,t.createElement)("ul",null,(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>n("Rename")},(0,t.createElement)("span",{className:"dashicons dashicons-edit",style:{marginRight:"5px"}})," Rename")),(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>n("Delete"),style:{color:"red"}},(0,t.createElement)("span",{className:"dashicons dashicons-trash",style:{marginRight:"5px"}})," Delete"))))},w=()=>{const{loading:e,error:r,clearError:n,successMessage:l,clearMessages:s,hideContextMenu:o}=m(),[c,i]=(0,a.useState)(!1),[d,p]=(0,a.useState)(!1),[w,v]=(0,a.useState)(!1),[b,C]=(0,a.useState)(!1),[N,k]=(0,a.useState)(null);return(0,t.createElement)("div",{className:"rz-file-manager",onClick:()=>{o()}},r&&(0,t.createElement)("div",{className:"rz-file-manager__error"},(0,t.createElement)("p",null,r),(0,t.createElement)("button",{onClick:s},"×")),l&&(0,t.createElement)("div",{className:"rz-file-manager__success"},(0,t.createElement)("p",null,l),(0,t.createElement)("button",{onClick:s},"×")),(0,t.createElement)(f,{onCreateFolder:()=>{i(!0)},onDelete:()=>{C(!0)}}),(0,t.createElement)(g,null),e?(0,t.createElement)("div",{className:"rz-file-manager__loading"},(0,t.createElement)(u.Spinner,null)):(0,t.createElement)(_,{onRename:e=>{k(e),v(!0)}}),c&&(0,t.createElement)(h,{isOpen:c,onClose:()=>i(!1)}),w&&N&&(0,t.createElement)(E,{isOpen:w,onClose:()=>v(!1),item:N}),b&&(0,t.createElement)(y,{isOpen:b,onClose:()=>C(!1)}),(0,t.createElement)(z,null))},v=()=>(0,t.createElement)(i,null,(0,t.createElement)("div",{className:"rz-file-manager-app"},(0,t.createElement)(w,null)));document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("rz-file-manager-root");e&&(0,a.render)((0,t.createElement)(i,null,(0,t.createElement)(v,null)),e)}))})();