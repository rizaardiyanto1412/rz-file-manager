(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,a=window.wp.element,n=window.wp.apiFetch;var r=e.n(n);const l="/rz-file-manager/v1",o=async(e,t)=>{try{const a=new FormData;a.append("file",t),a.append("path",e);const n=`${window.rzFileManager?.restUrl||"/wp-json"+l}/upload`,r=await fetch(n,{method:"POST",headers:{"X-WP-Nonce":window.rzFileManager?.nonce},body:a});return await r.json()}catch(e){return console.error("Error uploading file:",e),{success:!1,message:e.message}}},s=async e=>{try{return await r()({path:`${l}/delete`,method:"DELETE",data:{path:e}})}catch(e){return console.error("Error deleting item:",e),{success:!1,message:e.message}}},i=(0,a.createContext)(),c=({children:e})=>{const[n,c]=(0,a.useState)(""),[m,d]=(0,a.useState)([]),[u,g]=(0,a.useState)([]),[f,p]=(0,a.useState)(!1),[_,h]=(0,a.useState)(null),[E,y]=(0,a.useState)(null),[z,w]=(0,a.useState)("name"),[v,C]=(0,a.useState)("asc"),[b,N]=(0,a.useState)({visible:!1,x:0,y:0,item:null}),[k,x]=(0,a.useState)({isOpen:!1,file:null,content:"",isLoading:!1,error:null}),F=async()=>{p(!0),h(null);try{const e=await(async(e="")=>{try{console.log("fetchFiles called with path:",e),console.log("rzFileManager object:",window.rzFileManager);const t=`${window.rzFileManager?.restUrl}list`;console.log("Attempting standard fetch with URL:",t);const a=await fetch(`${t}?path=${encodeURIComponent(e)}`,{method:"GET",credentials:"include",headers:{"X-WP-Nonce":window.rzFileManager?.nonce,"Content-Type":"application/json"}});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return await a.json()}catch(e){return console.error("Error in fetchFiles (standard fetch):",e),{success:!1,message:e.message}}})(n);if(e.success){const t=S(e.items,z,v);d(t)}else h(e.message||"Failed to load files")}catch(e){h("Error loading files: "+(e.message||"Unknown error"))}finally{p(!1)}},S=(e,t,a)=>[...e].sort(((e,n)=>{if("directory"===e.type&&"directory"!==n.type)return-1;if("directory"!==e.type&&"directory"===n.type)return 1;let r=0;return"name"===t?r=e.name.localeCompare(n.name,void 0,{numeric:!0,sensitivity:"base"}):"size"===t?r=("directory"===e.type?-1:e.size)-("directory"===n.type?-1:n.size):"modified"===t&&(r=e.modified-n.modified),"asc"===a?r:-1*r})),M=e=>{c(e),g([])};(0,a.useEffect)((()=>{F()}),[n,z,v]),(0,a.useEffect)((()=>{if(E){const e=setTimeout((()=>{y(null)}),3e3);return()=>clearTimeout(e)}}),[E]);const R=()=>{x({isOpen:!1,file:null,content:"",isLoading:!1,error:null})},T={currentPath:n,items:m,selectedItems:u,loading:f,error:_,successMessage:E,navigateTo:M,navigateToParent:()=>{if(!n)return;const e=n.split("/");e.pop();const t=e.join("/");M(t)},toggleSelectItem:e=>{g((t=>t.some((t=>t.path===e.path))?t.filter((t=>t.path!==e.path)):[...t,e]))},isItemSelected:e=>u.some((t=>t.path===e.path)),clearSelection:()=>{g([])},clearMessages:()=>{h(null),y(null)},handleCreateFolder:async e=>{p(!0),h(null);try{const t=await(async(e,t)=>{try{return await r()({path:`${l}/create-folder`,method:"POST",data:{path:e,name:t}})}catch(e){return console.error("Error creating folder:",e),{success:!1,message:e.message}}})(n,e);t.success?(y(t.message||"Folder created successfully"),await F()):h(t.message||"Failed to create folder")}catch(e){h("Error creating folder: "+(e.message||"Unknown error"))}finally{p(!1)}},handleUploadFiles:async e=>{p(!0),h(null);try{for(let t=0;t<e.length;t++){const a=e[t],r=await o(n,a);if(!r.success){h(`Failed to upload ${a.name}: ${r.message||"Unknown error"}`);break}}y("Files uploaded successfully"),await F()}catch(e){h("Error uploading files: "+(e.message||"Unknown error"))}finally{p(!1)}},handleDeleteItems:async()=>{if(0!==u.length){p(!0),h(null);try{for(const e of u){const t=await s(e.path);if(!t.success){h(`Failed to delete ${e.name}: ${t.message||"Unknown error"}`);break}}y("Items deleted successfully"),g([]),await F()}catch(e){h("Error deleting items: "+(e.message||"Unknown error"))}finally{p(!1)}}},handleRenameItem:async(e,t)=>{p(!0),h(null);try{const a=await(async(e,t)=>{try{return await r()({path:`${l}/rename`,method:"POST",data:{path:e,newName:t}})}catch(e){return console.error("Error renaming item:",e),{success:!1,message:e.message}}})(e,t);a.success?(y(a.message||"Item renamed successfully"),await F()):h(a.message||"Failed to rename item")}catch(e){h("Error renaming item: "+(e.message||"Unknown error"))}finally{p(!1)}},reloadItems:F,sortKey:z,sortDirection:v,setSort:e=>{const t=z===e&&"asc"===v?"desc":"asc";w(e),C(t),d((a=>S(a,e,t)))},contextMenu:b,showContextMenu:(e,t)=>{N({visible:!0,x:t.pageX,y:t.pageY,item:e}),console.log("Context Menu Event - Captured Coords:",{clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY})},hideContextMenu:()=>{N((e=>({...e,visible:!1,item:null})))},editorState:k,openFileEditor:async e=>{if("file"===e.type){x({isOpen:!0,file:e,content:"",isLoading:!0,error:null});try{const t=await(async e=>{const t=`${l}/get-content?path=${encodeURIComponent(e)}`;try{return await r()({path:t,method:"GET"})}catch(e){return console.error("Error getting file content:",e),{success:!1,message:e.message}}})(e.path);if(!t.success)throw new Error(t.message||"Failed to load file content.");x((e=>({...e,content:t.content,isLoading:!1})))}catch(e){console.error("Error loading file content:",e),x((t=>({...t,isLoading:!1,error:e.message})))}}},closeFileEditor:R,saveEditedFile:async()=>{if(k.file){x((e=>({...e,isLoading:!0,error:null})));try{const e=await(async(e,t)=>{try{return await r()({path:`${l}/save-content`,method:"POST",data:{path:e,content:t}})}catch(e){return console.error("Error saving file content:",e),{success:!1,message:e.message}}})(k.file.path,k.content);if(!e.success)throw new Error(e.message||"Failed to save file content.");R(),y(e.message||"File saved successfully!")}catch(e){console.error("Error saving file content:",e),x((t=>({...t,isLoading:!1,error:e.message})))}}},handleEditorContentChange:e=>{x((t=>({...t,content:e})))}};return(0,t.createElement)(i.Provider,{value:T},e)},m=()=>(0,a.useContext)(i),d=window.wp.i18n,u=window.wp.components,g=({onCreateFolder:e,onUpload:a,onDelete:n})=>{const{selectedItems:r,navigateToParent:l,reloadItems:o,currentPath:s}=m();return(0,t.createElement)("div",{className:"rz-file-manager__toolbar"},(0,t.createElement)("div",{className:"rz-file-manager__toolbar-left"},(0,t.createElement)(u.Button,{variant:"secondary",onClick:()=>{l()},icon:"arrow-up-alt2",disabled:!s,className:"rz-file-manager__toolbar-button"},(0,d.__)("Parent Directory","rz-file-manager")),(0,t.createElement)(u.Button,{variant:"secondary",onClick:()=>{o()},icon:"update",className:"rz-file-manager__toolbar-button"},(0,d.__)("Refresh","rz-file-manager"))),(0,t.createElement)("div",{className:"rz-file-manager__toolbar-right"},(0,t.createElement)(u.Button,{variant:"primary",onClick:e,icon:"plus",className:"rz-file-manager__toolbar-button"},(0,d.__)("New Folder","rz-file-manager")),(0,t.createElement)(u.Button,{variant:"primary",onClick:a,icon:"upload",className:"rz-file-manager__toolbar-button"},(0,d.__)("Upload","rz-file-manager")),r.length>0&&(0,t.createElement)(u.Button,{variant:"secondary",onClick:n,icon:"trash",isDestructive:!0,className:"rz-file-manager__toolbar-button"},(0,d.__)("Delete","rz-file-manager"))))},f=()=>{const{currentPath:e,navigateTo:a}=m(),n=(()=>{const t=[{name:(0,d.__)("Root","rz-file-manager"),path:""}];if(!e)return t;const a=e.split("/");let n="";for(let e=0;e<a.length;e++)a[e]&&(n+=(n?"/":"")+a[e],t.push({name:a[e],path:n}));return t})();return(0,t.createElement)("div",{className:"rz-file-manager__breadcrumbs"},n.map(((e,n)=>(0,t.createElement)("span",{key:e.path},n>0&&(0,t.createElement)("span",{className:"rz-file-manager__breadcrumbs-separator"},"/"),(0,t.createElement)("a",{href:"#",className:"rz-file-manager__breadcrumbs-item",onClick:t=>{return n=e.path,t.preventDefault(),void a(n);var n}},e.name)))))},p=({item:e,onRename:a})=>{const{navigateTo:n,toggleSelectItem:r,isItemSelected:l,showContextMenu:o,handleDeleteItems:s,openFileEditor:i}=m();return(0,t.createElement)("tr",{className:"rz-file-manager__file-item "+(l(e)?"is-selected":""),onClick:t=>{const a=t.shiftKey,n=t.ctrlKey||t.metaKey;r(e,a,n)},onDoubleClick:()=>{"directory"===e.type?n(e.path):"file"===e.type&&i(e)},onContextMenu:t=>{t.preventDefault(),o(e,t)}},(0,t.createElement)("td",{className:"rz-file-manager__table-checkbox"},(0,t.createElement)("input",{type:"checkbox",checked:l(e),onChange:t=>{t.stopPropagation(),t.stopPropagation(),r(e)},"aria-label":`Select ${e.name}`})),(0,t.createElement)("td",{className:"rz-file-manager__table-name"},(0,t.createElement)("span",{className:`dashicons dashicons-${(()=>{if("directory"===e.type)return"portfolio";switch(e.name.split(".").pop().toLowerCase()){case"jpg":case"jpeg":case"png":case"gif":case"bmp":return"format-image";case"pdf":return"media-document";case"doc":case"docx":return"media-text";case"xls":case"xlsx":return"media-spreadsheet";case"ppt":case"pptx":return"media-interactive";case"zip":case"rar":case"7z":return"portfolio";case"txt":case"md":return"text-page";default:return"media-default"}})()}`,style:{marginRight:"8px",verticalAlign:"middle"}}),e.name),(0,t.createElement)("td",{className:"rz-file-manager__table-size"},"directory"===e.type?"-":((e,t=2)=>{if(0===e||"number"!=typeof e)return"0 Bytes";const a=t<0?0:t,n=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],r=Math.floor(Math.log(e)/Math.log(1024)),l=r<n.length?r:n.length-1;return parseFloat((e/Math.pow(1024,l)).toFixed(a))+" "+n[l]})(e.size)),(0,t.createElement)("td",{className:"rz-file-manager__table-modified"},(e=>{if(!e||"number"!=typeof e)return"-";try{const t=new Date(1e3*e);return isNaN(t.getTime())?"Invalid Date":t.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}catch(e){return console.error("Error formatting date:",e),"Error"}})(e.modified)))},_=({onRename:e})=>{const{items:a,currentPath:n,sortKey:r,sortDirection:l,setSort:o}=m();if(0===a.length)return(0,t.createElement)("div",{className:"rz-file-manager__empty"},(0,t.createElement)("p",null,(0,d.__)("This folder is empty.","rz-file-manager")));const s=e=>{o(e)},i=e=>{if(r!==e)return null;const a="asc"===l?"dashicons dashicons-arrow-up-alt2":"dashicons dashicons-arrow-down-alt2";return(0,t.createElement)("span",{className:a,style:{marginLeft:"5px"}})};return(0,t.createElement)("div",{className:"rz-file-manager__file-list"},(0,t.createElement)("table",{className:"rz-file-manager__table"},(0,t.createElement)("thead",{className:"rz-file-manager__table-head"},(0,t.createElement)("tr",{onClick:e=>e.stopPropagation()}," ",(0,t.createElement)("th",{className:"rz-file-manager__table-checkbox"},(0,t.createElement)("span",{className:"screen-reader-text"},(0,d.__)("Select","rz-file-manager"))),(0,t.createElement)("th",{className:"rz-file-manager__table-name",onClick:()=>s("name")},(0,d.__)("Name","rz-file-manager"),i("name")),(0,t.createElement)("th",{className:"rz-file-manager__table-size",onClick:()=>s("size")},(0,d.__)("Size","rz-file-manager"),i("size")),(0,t.createElement)("th",{className:"rz-file-manager__table-modified",onClick:()=>s("modified")},(0,d.__)("Modified","rz-file-manager"),i("modified")),(0,t.createElement)("th",{className:"rz-file-manager__table-actions"},(0,d.__)("Actions","rz-file-manager")))),(0,t.createElement)("tbody",null,a.map((a=>(0,t.createElement)(p,{key:a.path,item:a,onRename:e}))))))},h=({isOpen:e,onClose:n})=>{const{currentPath:r,handleCreateFolder:l}=m(),[o,s]=(0,a.useState)(""),[i,c]=(0,a.useState)("");return(0,t.createElement)(u.Modal,{title:(0,d.__)("Create New Folder","rz-file-manager"),onRequestClose:n,className:"rz-file-manager__modal"},(0,t.createElement)("form",{onSubmit:e=>{e.preventDefault(),o?/[\\/:*?"<>|]/.test(o)?c((0,d.__)("Folder name contains invalid characters.","rz-file-manager")):(l(o),n()):c((0,d.__)("Please enter a folder name.","rz-file-manager"))}},(0,t.createElement)("div",{className:"rz-file-manager__modal-content"},(0,t.createElement)("p",null,(0,d.__)("Create a new folder in:","rz-file-manager"),(0,t.createElement)("strong",null,r||"/")),(0,t.createElement)(u.TextControl,{label:(0,d.__)("Folder Name","rz-file-manager"),value:o,onChange:e=>{s(e),c("")},placeholder:(0,d.__)("Enter folder name","rz-file-manager"),autoFocus:!0}),i&&(0,t.createElement)("div",{className:"rz-file-manager__modal-error"},i)),(0,t.createElement)("div",{className:"rz-file-manager__modal-footer"},(0,t.createElement)(u.Button,{variant:"secondary",onClick:n},(0,d.__)("Cancel","rz-file-manager")),(0,t.createElement)(u.Button,{variant:"primary",type:"submit"},(0,d.__)("Create Folder","rz-file-manager")))))},E=({isOpen:e,onClose:n,item:r})=>{const{handleRenameItem:l}=m(),[o,s]=(0,a.useState)(""),[i,c]=(0,a.useState)("");return(0,a.useEffect)((()=>{r&&s(r.name)}),[r]),(0,t.createElement)(u.Modal,{title:(0,d.__)("Rename","rz-file-manager"),onRequestClose:n,className:"rz-file-manager__modal"},(0,t.createElement)("form",{onSubmit:e=>{e.preventDefault(),o?/[\\/:*?"<>|]/.test(o)?c((0,d.__)("Name contains invalid characters.","rz-file-manager")):o!==r.name?(l(r.path,o),n()):n():c((0,d.__)("Please enter a name.","rz-file-manager"))}},(0,t.createElement)("div",{className:"rz-file-manager__modal-content"},(0,t.createElement)("p",null,r&&"directory"===r.type?(0,d.__)("Rename folder:","rz-file-manager"):(0,d.__)("Rename file:","rz-file-manager"),(0,t.createElement)("strong",null,r?r.name:"")),(0,t.createElement)(u.TextControl,{label:(0,d.__)("New Name","rz-file-manager"),value:o,onChange:e=>{s(e),c("")},placeholder:(0,d.__)("Enter new name","rz-file-manager"),autoFocus:!0}),i&&(0,t.createElement)("div",{className:"rz-file-manager__modal-error"},i)),(0,t.createElement)("div",{className:"rz-file-manager__modal-footer"},(0,t.createElement)(u.Button,{variant:"secondary",onClick:n},(0,d.__)("Cancel","rz-file-manager")),(0,t.createElement)(u.Button,{variant:"primary",type:"submit"},(0,d.__)("Rename","rz-file-manager")))))},y=({isOpen:e,onClose:a})=>{const{selectedItems:n,handleDeleteItems:r}=m();return(0,t.createElement)(u.Modal,{title:(0,d.__)("Confirm Deletion","rz-file-manager"),onRequestClose:a,className:"rz-file-manager__modal"},(0,t.createElement)("div",{className:"rz-file-manager__modal-content"},(0,t.createElement)("p",null,(()=>{const e=n.filter((e=>"directory"!==e.type)).length,t=n.filter((e=>"directory"===e.type)).length;return e>0&&t>0?(0,d.__)(`Are you sure you want to delete ${e} file(s) and ${t} folder(s)? This action cannot be undone.`,"rz-file-manager"):e>0?(0,d.__)(`Are you sure you want to delete ${e} file(s)? This action cannot be undone.`,"rz-file-manager"):t>0?(0,d.__)(`Are you sure you want to delete ${t} folder(s) and all their contents? This action cannot be undone.`,"rz-file-manager"):(0,d.__)("Are you sure you want to delete the selected items? This action cannot be undone.","rz-file-manager")})()),(0,t.createElement)("ul",{className:"rz-file-manager__delete-list"},n.map((e=>(0,t.createElement)("li",{key:e.path},(0,t.createElement)("strong",null,e.name),"directory"===e.type?` (${(0,d.__)("Folder","rz-file-manager")})`:""))))),(0,t.createElement)("div",{className:"rz-file-manager__modal-footer"},(0,t.createElement)(u.Button,{variant:"secondary",onClick:a},(0,d.__)("Cancel","rz-file-manager")),(0,t.createElement)(u.Button,{variant:"primary",onClick:()=>{r(),a()},isDestructive:!0},(0,d.__)("Delete","rz-file-manager"))))},z=()=>{const{editorState:e,handleEditorContentChange:a,saveEditedFile:n,closeFileEditor:r}=m();return e.isOpen&&e.file?(0,t.createElement)(u.Modal,{title:sprintf((0,d.__)("Editing: %s","rz-file-manager"),e.file.name),onRequestClose:r,className:"rz-file-manager__editor-modal"},e.isLoading&&""===e.content&&(0,t.createElement)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px"}},(0,t.createElement)(u.Spinner,null)),e.isLoading&&""===e.content?null:(0,t.createElement)(u.TextareaControl,{label:(0,d.__)("File Content","rz-file-manager"),value:e.content,onChange:a,rows:20,className:"rz-file-manager__editor-textarea",disabled:e.isLoading}),e.error&&(0,t.createElement)("p",{style:{color:"red"}},(0,d.__)("Error:","rz-file-manager")," ",e.error),(0,t.createElement)("div",{className:"rz-file-manager__modal-actions"},(0,t.createElement)(u.Button,{isSecondary:!0,onClick:r,disabled:e.isLoading},(0,d.__)("Cancel","rz-file-manager")),(0,t.createElement)(u.Button,{isPrimary:!0,onClick:n,isBusy:e.isLoading,disabled:e.isLoading},(0,d.__)("Save Changes","rz-file-manager")))):null},w=window.ReactDOM,v=()=>{const{contextMenu:e,hideContextMenu:a,openFileEditor:n}=m(),r=(0,t.useRef)(null);if((0,t.useEffect)((()=>{const t=e=>{r.current&&!r.current.contains(e.target)&&a()};return e.visible?document.addEventListener("mousedown",t):document.removeEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}}),[e.visible,a]),!e.visible||!e.item)return null;const l={position:"absolute",top:`${e.y}px`,left:`${e.x}px`,zIndex:1e3},o=(0,t.createElement)("div",{ref:r,className:"rz-file-manager-context-menu",style:l},console.log("Context Menu Applied Style:",l),(0,t.createElement)("ul",null,"file"===e.item.type&&(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>{e.item&&"file"===e.item.type&&n(e.item),a()}},(0,t.createElement)("span",{className:"dashicons dashicons-edit",style:{marginRight:"5px"}})," ",(0,d.__)("Edit","rz-file-manager"))),(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>{console.log("Rename clicked for:",e.item.name),a()}},(0,t.createElement)("span",{className:"dashicons dashicons-edit",style:{marginRight:"5px"}})," Rename")),(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>(console.log("Delete clicked for:",e.item.name),void a()),style:{color:"red"}},(0,t.createElement)("span",{className:"dashicons dashicons-trash",style:{marginRight:"5px"}})," Delete"))));return(0,w.createPortal)(o,document.body)},C=()=>{const{loading:e,error:n,clearError:r,successMessage:l,clearMessages:o,hideContextMenu:s}=m(),[i,c]=(0,a.useState)(!1),[d,p]=(0,a.useState)(!1),[w,C]=(0,a.useState)(!1),[b,N]=(0,a.useState)(!1),[k,x]=(0,a.useState)(null);return(0,t.createElement)("div",{className:"rz-file-manager",onClick:()=>{s()}},n&&(0,t.createElement)("div",{className:"rz-file-manager__error"},(0,t.createElement)("p",null,n),(0,t.createElement)("button",{onClick:o},"×")),l&&(0,t.createElement)("div",{className:"rz-file-manager__success"},(0,t.createElement)("p",null,l),(0,t.createElement)("button",{onClick:o},"×")),(0,t.createElement)(g,{onCreateFolder:()=>{c(!0)},onDelete:()=>{N(!0)}}),(0,t.createElement)(f,null),e?(0,t.createElement)("div",{className:"rz-file-manager__loading"},(0,t.createElement)(u.Spinner,null)):(0,t.createElement)(_,{onRename:e=>{x(e),C(!0)}}),i&&(0,t.createElement)(h,{isOpen:i,onClose:()=>c(!1)}),w&&k&&(0,t.createElement)(E,{isOpen:w,onClose:()=>C(!1),item:k}),b&&(0,t.createElement)(y,{isOpen:b,onClose:()=>N(!1)}),(0,t.createElement)(v,null),(0,t.createElement)(z,null))},b=()=>(0,t.createElement)(c,null,(0,t.createElement)("div",{className:"rz-file-manager-app"},(0,t.createElement)(C,null)));document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("rz-file-manager-root");e&&(0,a.render)((0,t.createElement)(c,null,(0,t.createElement)(b,null)),e)}))})();