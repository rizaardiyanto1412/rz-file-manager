(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,n=window.wp.element,a={currentPath:"",items:[],selectedItems:[],loading:!1,error:null,successMessage:null,uploadError:null,sortKey:"name",sortDirection:"asc",contextMenu:{visible:!1,x:0,y:0,item:null},editorState:{isOpen:!1,file:null,content:"",isLoading:!1,error:null},renameModalState:{isOpen:!1,item:null},createFolderModalState:{isOpen:!1},deleteModalState:{isOpen:!1,itemsToDelete:[]},uploadModalState:{isOpen:!1},newFileModalState:{isOpen:!1},clipboardState:{action:null,items:[]}},r=window.wp.apiFetch;var l=e.n(r);const o="/rz-file-manager/v1",i=async(e="")=>{try{const t=`${window.rzFileManagerData?.restUrl}list`,n=await fetch(`${t}?path=${encodeURIComponent(e)}`,{method:"GET",credentials:"include",headers:{"X-WP-Nonce":window.rzFileManagerData?.restNonce,"Content-Type":"application/json"}});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return await n.json()}catch(e){return{success:!1,message:e.message}}},s=async(e,t)=>{try{const n=new FormData;n.append("file",t),n.append("current_path",e);const a="rz-file-manager/v1";let r=window.rzFileManagerData?.restUrl||`/wp-json/${a}`;r.endsWith("/")&&(r=r.slice(0,-1));const l=`${r}/upload`,o=await fetch(l,{method:"POST",headers:{"X-WP-Nonce":window.rzFileManagerData?.nonce||window.rzFileManagerData?.restNonce},body:n});return await o.json()}catch(e){let t="Network error during upload";if(e.response)try{t=(await e.response.json()).message||e.response.statusText}catch(n){t=e.response.statusText}else e.message&&(t=e.message);return{success:!1,message:t}}},c=async e=>{try{return await l()({path:`${o}/delete`,method:"DELETE",data:{path:e}})}catch(e){return{success:!1,message:e.message}}},d=async(e,t)=>l()({path:o+"/copy",method:"POST",data:{source:e,destination:t}}),m=async(e,t)=>l()({path:o+"/move",method:"POST",data:{source:e,destination:t}}),u=(e,t,n)=>[...e].sort(((e,a)=>{if("directory"===e.type&&"directory"!==a.type)return-1;if("directory"!==e.type&&"directory"===a.type)return 1;let r=0;return"name"===t?r=e.name.localeCompare(a.name,void 0,{numeric:!0,sensitivity:"base"}):"size"===t?r=("directory"===e.type?-1:e.size)-("directory"===a.type?-1:a.size):"modified"===t&&(r=e.modified-a.modified),"asc"===n?r:-1*r})),f=(e,t)=>{const{updateState:a,clearMessages:r,clearUploadError:d}=((e,t)=>{const a=e=>{t((t=>({...t,...e})))},r=(0,n.useCallback)((()=>{a({error:null,successMessage:null})}),[]),l=(0,n.useCallback)((()=>{a({uploadError:null})}),[]);return{updateState:a,clearMessages:r,clearUploadError:l}})(0,t),{loadItems:m,handleCreateFolder:f,handleCreateFile:p,handleRenameItem:g}=((e,t)=>{const{currentPath:a,sortKey:r,sortDirection:s}=e,c=(0,n.useCallback)((async()=>{t({loading:!0,error:null,selectedItems:[]}),t({contextMenu:{visible:!1,x:0,y:0,item:null}});try{const e=await i(a);if(e.success){const n=u(e.items,r,s);t({items:n})}else t({error:e.message||"Failed to load files"})}catch(e){t({error:"Error loading files: "+(e.message||"Unknown error")})}finally{t({loading:!1})}}),[a,r,s,t]);return{loadItems:c,handleCreateFolder:async e=>{t({loading:!0,error:null,successMessage:null,createFolderModalState:{isOpen:!1}});try{const n=await(async(e,t)=>{try{return await l()({path:`${o}/create-folder`,method:"POST",data:{path:e,name:t}})}catch(e){return{success:!1,message:e.message}}})(a,e);n.success?(t({successMessage:n.message||"Folder created successfully"}),await c()):t({error:n.message||"Failed to create folder"})}catch(e){t({error:"Error creating folder: "+(e.message||"Unknown error")})}finally{t({loading:!1})}},handleCreateFile:async e=>{t({loading:!0,error:null,successMessage:null,newFileModalState:{isOpen:!1}});try{const n=await(async(e,t)=>{const n=`${window.rzFileManagerData?.restUrl}create-file`,a=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.rzFileManagerData?.restNonce},body:JSON.stringify({path:e,filename:t})});if(!a.ok){let e=`HTTP error! status: ${a.status} ${a.statusText}`;try{e=(await a.json()).message||e}catch(e){}throw new Error(e)}return a.json()})(a,e);n.success?(t({successMessage:n.message||"File created successfully"}),await c()):t({error:n.message||"Failed to create file"})}catch(e){t({error:"Error creating file: "+(e.message||"Unknown error")})}finally{t({loading:!1})}},handleRenameItem:async(e,n)=>{t({loading:!0,error:null,successMessage:null});try{const a=await(async(e,t)=>{try{return await l()({path:`${o}/rename`,method:"POST",data:{path:e,new_name:t}})}catch(e){return{success:!1,message:e.message}}})(e,n);a.success?(t({successMessage:a.message||"Item renamed successfully"}),await c()):t({error:a.message||"Failed to rename item"})}catch(e){t({error:"Error renaming item: "+(e.message||"Unknown error")})}finally{t({loading:!1})}}}})(e,a),{handleDeleteSelectedItems:h,handleDeleteItem:y}=((e,t,a)=>{const{deleteModalState:r}=e;return{handleDeleteSelectedItems:(0,n.useCallback)((async()=>{const e=r.itemsToDelete;if(!e||0===e.length)return console.error("No items selected for deletion in modal state."),void t({deleteModalState:{isOpen:!1,itemsToDelete:[]}});t({loading:!0,error:null,successMessage:null,deleteModalState:{isOpen:!1,itemsToDelete:[]}});try{const n=e.map((e=>c(e.path))),r=await Promise.allSettled(n),l=r.filter((e=>"rejected"===e.status)),o=r.filter((e=>"fulfilled"===e.status&&e.value.success));if(l.length>0){console.error("Failed deletions:",l);const e=l.map((e=>e.reason?.message||"Failed to delete an item."));t({error:`Failed to delete ${l.length} item(s). Errors: ${e.join(", ")}`})}o.length>0&&t({successMessage:`${o.length} item(s) deleted successfully.`}),await a()}catch(e){console.error("Deletion failed:",e),t({error:e.message||"An unexpected error occurred during deletion."})}finally{t({loading:!1})}}),[r.itemsToDelete,t,a]),handleDeleteItem:async()=>{if(!r.itemsToDelete||0===r.itemsToDelete.length)return;const e=r.itemsToDelete[0];t({loading:!0,error:null,successMessage:null,deleteModalState:{isOpen:!1,itemsToDelete:[]}});try{const n=await c(e.path);n.success?(t({successMessage:n.message||"Item deleted successfully"}),await a()):t({error:`Failed to delete ${e.name}: ${n.message||"Unknown error"}`})}catch(e){t({error:"Error deleting item: "+(e.message||"Unknown error")})}finally{t({loading:!1})}}}})(e,a,m),{handleUploadFiles:E}=((e,t,n)=>{const{currentPath:a}=e;return{handleUploadFiles:async e=>{if(!e||0===e.length)return t({error:"No files selected for upload."}),setTimeout((()=>t({error:null})),3e3),void t({uploadModalState:{isOpen:!1}});t({loading:!0,error:null,successMessage:null,uploadError:null});let r=!0,l="";try{for(let n=0;n<e.length;n++){const l=e[n],o=await s(a,l);o.success||(t({error:`Failed to upload ${l.name}: ${o.message||"Unknown error"}`,uploadError:o.message||"An unknown error occurred."}),r=!1)}r&&(l=e.length>1?"Files uploaded successfully":"File uploaded successfully",t({successMessage:l})),await n()}catch(e){t({error:"Error uploading files: "+(e.message||"Unknown error"),uploadError:e.message||"A critical error occurred during upload."}),r=!1}finally{t({loading:!1}),r&&t({uploadModalState:{isOpen:!1}})}}}})(e,a,m),{openFileEditor:_,closeFileEditor:w,saveEditedFile:v,handleEditorContentChange:b}=((e,t)=>{const n=()=>{t({editorState:{isOpen:!1,file:null,content:"",isLoading:!1,error:null}})};return{openFileEditor:async e=>{if("file"===e.type){t({editorState:{isOpen:!0,file:e,content:"",isLoading:!0,error:null}});try{const n=await(async e=>{const t=`${o}/get-content?path=${encodeURIComponent(e)}`;try{return await l()({path:t,method:"GET"})}catch(e){return{success:!1,message:e.message}}})(e.path);if(!n.success)throw new Error(n.message||"Failed to load file content.");t({editorState:{isOpen:!0,file:e,content:n.content,isLoading:!1,error:null}})}catch(n){t({editorState:{isOpen:!0,file:e,content:"",isLoading:!1,error:n.message}})}}},closeFileEditor:n,saveEditedFile:async()=>{const{editorState:a}=e;if(a.file){t({editorState:{...a,isLoading:!0,error:null}});try{const e=await(async(e,t)=>{try{return await l()({path:`${o}/save-content`,method:"POST",data:{path:e,content:t}})}catch(e){return{success:!1,message:e.message}}})(a.file.path,a.content);if(!e.success)throw new Error(e.message||"Failed to save file content.");n(),t({successMessage:e.message||"File saved successfully!"})}catch(e){t({editorState:{...a,isLoading:!1,error:e.message}})}}},handleEditorContentChange:n=>{const{editorState:a}=e;t({editorState:{...a,content:n}})}}})(e,a);return{loadItems:m,handleCreateFolder:f,handleCreateFile:p,handleRenameItem:g,handleDeleteSelectedItems:h,handleDeleteItem:y,handleUploadFiles:E,openFileEditor:_,closeFileEditor:w,saveEditedFile:v,handleEditorContentChange:b,clearMessages:r,clearUploadError:d}},p=(0,n.createContext)(),g=({children:e})=>{const[r,l]=(0,n.useState)(a),o=f(r,l),i=((e,t)=>{const a=(0,n.useCallback)((e=>{var n;n={currentPath:e,selectedItems:[]},t((e=>({...e,...n})))}),[]),r=(0,n.useCallback)((()=>{const{currentPath:t}=e;if(!t)return;const n=t.split("/");n.pop();const r=n.join("/");a(r)}),[e.currentPath]);return{navigateTo:a,navigateToParent:r}})(r,l),s=((e,t)=>{const{items:a,selectedItems:r}=e,l=e=>{t((t=>({...t,...e})))};return{toggleSelectItem:(0,n.useCallback)(((e,t)=>{const n=t.shiftKey,o=(t.ctrlKey||t.metaKey,r.some((t=>t.path===e.path)));let i=[...r];if(n&&r.length>0){const t=r[r.length-1],n=a.findIndex((e=>e.path===t.path)),l=a.findIndex((t=>t.path===e.path)),o=Math.min(n,l),s=Math.max(n,l),c=a.slice(o,s+1);i=[...i,...c]}else i=o?i.filter((t=>t.path!==e.path)):[...i,e];l({selectedItems:i})}),[a,r]),toggleSelectAll:(0,n.useCallback)((()=>{const e=a.length>0&&r.length===a.length;l(e?{selectedItems:[]}:{selectedItems:[...a]})}),[a,r]),isItemSelected:(0,n.useCallback)((e=>r.some((t=>t.path===e.path))),[r]),clearSelection:(0,n.useCallback)((()=>{l({selectedItems:[]})}),[]),areAllItemsSelected:a.length>0&&r.length===a.length}})(r,l),c=((e,t)=>{const a=e=>{t((t=>({...t,...e})))};return{showContextMenu:(0,n.useCallback)(((e,t)=>{a({contextMenu:{visible:!0,x:t.pageX,y:t.pageY,item:e}})}),[]),hideContextMenu:(0,n.useCallback)((()=>{a({contextMenu:{visible:!1,x:0,y:0,item:null}})}),[]),openRenameModal:(0,n.useCallback)((e=>{a({renameModalState:{isOpen:!0,item:e}})}),[]),closeRenameModal:(0,n.useCallback)((()=>{a({renameModalState:{isOpen:!1,item:null}})}),[]),openCreateFolderModal:(0,n.useCallback)((()=>{a({createFolderModalState:{isOpen:!0}})}),[]),closeCreateFolderModal:(0,n.useCallback)((()=>{a({createFolderModalState:{isOpen:!1}})}),[]),openDeleteModal:(0,n.useCallback)((e=>{e&&0!==e.length?a({deleteModalState:{isOpen:!0,itemsToDelete:e}}):console.warn("openDeleteModal called with no items.")}),[]),closeDeleteModal:(0,n.useCallback)((()=>{a({deleteModalState:{isOpen:!1,itemsToDelete:[]}})}),[]),openUploadModal:(0,n.useCallback)((()=>{a({uploadModalState:{isOpen:!0}})}),[]),closeUploadModal:(0,n.useCallback)((()=>{a({uploadModalState:{isOpen:!1}})}),[]),openNewFileModal:(0,n.useCallback)((()=>{a({newFileModalState:{isOpen:!0}})}),[]),closeNewFileModal:(0,n.useCallback)((()=>{a({newFileModalState:{isOpen:!1}})}),[])}})(0,l),g=((e,t,a)=>{const{currentPath:r,clipboardState:l}=e,o=e=>{t((t=>({...t,...e})))};return{handleCopyItems:(0,n.useCallback)((e=>{e&&0!==e.length&&o({clipboardState:{action:"copy",items:e},successMessage:`${e.length} item(s) added to clipboard for copying.`,error:null})}),[]),handleCutItems:(0,n.useCallback)((e=>{e&&0!==e.length&&o({clipboardState:{action:"cut",items:e},successMessage:`${e.length} item(s) added to clipboard for cutting.`,error:null})}),[]),handlePasteItems:(0,n.useCallback)((async()=>{const{action:e,items:t}=l;if(!e||!t||0===t.length)return void o({error:"Clipboard is empty or action is invalid."});o({loading:!0,error:null,successMessage:null});const n=r,i="copy"===e?d:m,s="copy"===e?"copied":"moved",c=t.map((e=>{const t=e.path,a="/"===n?"/"+e.name:n+"/"+e.name;return i(t,a)})),u=await Promise.allSettled(c),f=u.filter((e=>"rejected"===e.status||"fulfilled"===e.status&&!e.value.success)),p=u.filter((e=>"fulfilled"===e.status&&e.value.success));if(f.length>0){console.error(`Failed ${e} operations:`,f);const t=f.map((t=>{const n=t.reason||t.value;return n?.message||`Failed to ${e} an item.`}));o({error:`${f.length} item(s) failed to ${e}. Error: ${t[0]}`})}p.length>0&&(o({successMessage:`${p.length} item(s) ${s} successfully to ${n}.`}),"cut"===e&&o({clipboardState:{action:null,items:[]}}),await a()),o({loading:!1})}),[l,r,a])}})(r,l,o.loadItems),h=((e,t)=>{const{sortKey:a,sortDirection:r}=e;return{setSort:(0,n.useCallback)((n=>{const l=a===n&&"asc"===r?"desc":"asc",o=u(e.items,n,l);var i;i={sortKey:n,sortDirection:l,items:o},t((e=>({...e,...i})))}),[e.items,a,r])}})(r,l),y=((e,t,a)=>{const{currentPath:r}=e,l=e=>{t((t=>({...t,...e})))};return{handleZipItem:(0,n.useCallback)((async e=>{console.log("Attempting to zip:",e),l({loading:!0,error:null,successMessage:null});try{await(async e=>{const t=`${window.rzFileManagerData?.restUrl}zip`;try{const n=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.rzFileManagerData?.restNonce},body:JSON.stringify({path:e})}),a=await n.json();if(!n.ok){const e=a.message||`HTTP error! status: ${n.status}`;throw{code:a.code||"zip_failed",message:e,data:a.data||null}}return a}catch(e){throw console.error("Error zipping item:",e),e}})(e),await a(),l({successMessage:"Item zipped successfully."})}catch(e){console.error("Zip failed:",e),l({error:e.message||"Failed to zip item. Please ensure the server has permissions and the PHP Zip extension is enabled."})}finally{l({loading:!1})}}),[r,a]),handleUnzipItem:(0,n.useCallback)((async(e,t=!1)=>{console.log(`Attempting to unzip: ${e}, Unzip Here: ${t}`),l({loading:!0,error:null,successMessage:null});try{await(async(e,t=!1)=>{const n=`${window.rzFileManagerData?.restUrl}unzip`;try{const a=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.rzFileManagerData?.restNonce},body:JSON.stringify({path:e,unzipHere:t})}),r=await a.json();if(!a.ok){const e=r.message||`HTTP error! status: ${a.status}`;throw{code:r.code||"unzip_failed",message:e,data:r.data||null}}return r}catch(e){throw console.error("Error unzipping item:",e),e}})(e,t),await a(),l({successMessage:"Archive extracted successfully."})}catch(e){console.error("Unzip failed:",e);let t="Failed to unzip archive.";"unzip_destination_exists"===e.code?t=e.message||"Cannot extract: A file or folder with the target name already exists.":e.message&&(t=e.message),l({error:t})}finally{l({loading:!1})}}),[r,a])}})(r,l,o.loadItems);(0,n.useEffect)((()=>{o.loadItems()}),[r.currentPath]),(0,n.useEffect)((()=>{if(r.successMessage){const e=setTimeout((()=>{l((e=>({...e,successMessage:null})))}),3e3);return()=>clearTimeout(e)}}),[r.successMessage]),(0,n.useEffect)((()=>{o.loadItems()}),[r.currentPath,r.sortKey,r.sortDirection]);const E=(0,n.useMemo)((()=>({...r,...o,...i,...s,...c,...g,...h,...y,areAllItemsSelected:r.items.length>0&&r.selectedItems.length===r.items.length})),[r,o,i,s,c,g,h,y]);return(0,t.createElement)(p.Provider,{value:E},e)},h=p,y=()=>(0,n.useContext)(h),E=window.wp.i18n,_=window.wp.components,w=({message:e,onRemove:n,children:a})=>(0,t.createElement)("div",{style:{position:"fixed",bottom:"32px",right:"32px",zIndex:9999,maxWidth:"360px",pointerEvents:"none"},className:"rz-file-manager__snackbar-portal"},(0,t.createElement)("div",{style:{pointerEvents:"auto"}},a||(0,t.createElement)(_.Snackbar,{onRemove:n},e))),v=()=>{const{selectedItems:e,navigateToParent:n,loadItems:a,currentPath:r,openCreateFolderModal:l,openUploadModal:o,openNewFileModal:i,loading:s}=y();return e.length,(0,t.createElement)("div",{className:"rz-file-manager__toolbar"},(0,t.createElement)("div",{className:"rz-file-manager__toolbar-left"},(0,t.createElement)(_.Button,{variant:"secondary",onClick:()=>{n()},icon:"arrow-up-alt2",disabled:!r,className:"rz-file-manager__toolbar-button"},(0,E.__)("Parent Directory","rz-file-manager")),(0,t.createElement)(_.Button,{variant:"secondary",onClick:()=>{a()},icon:"update",className:"rz-file-manager__toolbar-button"},(0,E.__)("Refresh","rz-file-manager"))))},b=()=>{const{currentPath:e,navigateTo:n}=y(),a=(()=>{const t=[{name:(0,E.__)("Root","rz-file-manager"),path:""}];if(!e)return t;const n=e.split("/");let a="";for(let e=0;e<n.length;e++)n[e]&&(a+=(a?"/":"")+n[e],t.push({name:n[e],path:a}));return t})();return(0,t.createElement)("div",{className:"rz-file-manager__breadcrumbs"},a.map(((e,a)=>(0,t.createElement)("span",{key:e.path},a>0&&(0,t.createElement)("span",{className:"rz-file-manager__breadcrumbs-separator"},"/"),(0,t.createElement)("a",{href:"#",className:"rz-file-manager__breadcrumbs-item",onClick:t=>{return a=e.path,t.preventDefault(),void n(a);var a}},e.name)))))},z=({item:e,onRename:n})=>{const{navigateTo:a,toggleSelectItem:r,isItemSelected:l,showContextMenu:o,handleDeleteItems:i,openFileEditor:s}=y();return(0,t.createElement)("tr",{className:"rz-file-manager__file-item "+(l(e)?"is-selected":""),onClick:e=>{},onDoubleClick:()=>{"directory"===e.type?a(e.path):"file"===e.type&&s(e)},onContextMenu:t=>{t.preventDefault(),t.stopPropagation(),o(e,t)}},(0,t.createElement)("td",{className:"rz-file-manager__table-checkbox"},(0,t.createElement)("input",{type:"checkbox",checked:l(e),onChange:t=>{t.stopPropagation(),r(e,t)},"aria-label":`Select ${e.name}`})),(0,t.createElement)("td",{className:"rz-file-manager__table-name"},(0,t.createElement)("span",{className:`dashicons dashicons-${(()=>{if("directory"===e.type)return"portfolio";switch(e.name.split(".").pop().toLowerCase()){case"jpg":case"jpeg":case"png":case"gif":case"bmp":return"format-image";case"pdf":return"media-document";case"doc":case"docx":return"media-text";case"xls":case"xlsx":return"media-spreadsheet";case"ppt":case"pptx":return"media-interactive";case"zip":case"rar":case"7z":return"portfolio";case"txt":case"md":return"text-page";default:return"media-default"}})()}`,style:{marginRight:"8px",verticalAlign:"middle",color:"directory"===e.type?"#f0ad4e":"#5bc0de"}}),e.name),(0,t.createElement)("td",{className:"rz-file-manager__table-size"},"directory"===e.type?"-":((e,t=2)=>{if(0===e||"number"!=typeof e)return"0 Bytes";const n=t<0?0:t,a=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],r=Math.floor(Math.log(e)/Math.log(1024)),l=r<a.length?r:a.length-1;return parseFloat((e/Math.pow(1024,l)).toFixed(n))+" "+a[l]})(e.size)),(0,t.createElement)("td",{className:"rz-file-manager__table-modified"},(e=>{if(!e||"number"!=typeof e)return"-";try{const t=new Date(1e3*e);return isNaN(t.getTime())?"Invalid Date":t.toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})}catch(e){return"Error"}})(e.modified)))},M=({onRename:e})=>{const{items:n,sortKey:a,sortDirection:r,setSort:l,toggleSelectAll:o,areAllItemsSelected:i,selectedItems:s}=y();if(0===n.length)return(0,t.createElement)("div",{className:"rz-file-manager__empty",onContextMenu:e=>{e.preventDefault(),"undefined"!=typeof window&&window?.rzShowContextMenu&&window.rzShowContextMenu(null,e)}},(0,t.createElement)("span",{className:"dashicons dashicons-portfolio"}),(0,t.createElement)("p",null,(0,E.__)("This folder is empty.","rz-file-manager")),(0,t.createElement)("p",{className:"rz-file-manager__empty-hint"},(0,E.__)("Upload files or create a new folder to get started.","rz-file-manager")));const c=e=>{l(e)},d=e=>{if(a!==e)return null;const n="asc"===r?"dashicons dashicons-arrow-up-alt2":"dashicons dashicons-arrow-down-alt2";return(0,t.createElement)("span",{className:n,style:{marginLeft:"5px"}})};return(0,t.createElement)("div",{className:"rz-file-manager__file-list",style:{minHeight:"400px",flexGrow:1,display:"flex",flexDirection:"column"},onContextMenu:e=>{e.target.closest(".rz-file-manager__table-row")||(e.preventDefault(),"undefined"!=typeof window&&window?.rzShowContextMenu&&window.rzShowContextMenu(null,e))}},(0,t.createElement)("table",{className:"rz-file-manager__table",style:{flex:"0 0 auto"}},(0,t.createElement)("thead",{className:"rz-file-manager__table-head"},(0,t.createElement)("tr",{onClick:e=>e.stopPropagation()}," ",(0,t.createElement)("th",{className:"rz-file-manager__table-checkbox"},(0,t.createElement)("input",{type:"checkbox","aria-label":(0,E.__)("Select all items","rz-file-manager"),checked:i,onChange:o,disabled:0===n.length})),(0,t.createElement)("th",{className:"rz-file-manager__table-name",onClick:()=>c("name")},(0,E.__)("Name","rz-file-manager"),d("name")),(0,t.createElement)("th",{className:"rz-file-manager__table-size",onClick:()=>c("size")},(0,E.__)("Size","rz-file-manager"),d("size")),(0,t.createElement)("th",{className:"rz-file-manager__table-modified",onClick:()=>c("modified")},(0,E.__)("Modified","rz-file-manager"),d("modified")))),(0,t.createElement)("tbody",null,n.map((n=>(0,t.createElement)(z,{key:n.path,item:n,onRename:e}))))))},C=(0,t.memo)((({folder:e,onFolderClick:a,currentPath:r,level:l=0,isOpen:o,onToggle:s})=>{const[c,d]=(0,n.useState)([]),[m,u]=(0,n.useState)(!1),[f,p]=(0,n.useState)(!1),g=r===e.path,h=(0,n.useCallback)((async()=>{if(!(f&&0===c.length||f&&c.length>0)){u(!0);try{const t=await i(e.path);if(t.success&&t.items){const e=t.items.filter((e=>"folder"===e.type||"directory"===e.type));d(e)}p(!0)}catch(e){console.error("Error loading folder children:",e)}finally{u(!1)}}}),[e.path,f,c.length]);(0,n.useEffect)((()=>{""!==e.path||f||h()}),[e.path,f,h]),(0,n.useEffect)((()=>{o&&!f&&h()}),[o,f,h]);const y=(0,n.useCallback)((()=>{a(e.path),o||s(e.path)}),[a,e.path,o,s]);return(0,t.createElement)("div",{className:"rz-folder-tree-item"},(0,t.createElement)("div",{className:"rz-folder-tree-item__header "+(g?"is-active":""),style:{paddingLeft:16*l+"px"}},(0,t.createElement)("button",{className:"rz-folder-tree-item__toggle",onClick:()=>s(e.path),"aria-label":o?(0,E.__)("Collapse folder","rz-file-manager"):(0,E.__)("Expand folder","rz-file-manager")},(0,t.createElement)("span",{className:"dashicons "+(o?"dashicons-arrow-down-alt2":"dashicons-arrow-right-alt2")})),(0,t.createElement)("div",{className:"rz-folder-tree-item__name",onClick:y},(0,t.createElement)("span",{className:"dashicons dashicons-portfolio",style:{color:"#f0ad4e"}}),(0,t.createElement)("span",{className:"rz-folder-tree-item__label"},e.name))),o&&(0,t.createElement)("div",{className:"rz-folder-tree-item__children"},m?(0,t.createElement)("div",{className:"rz-folder-tree-item__loading"},(0,t.createElement)(_.Spinner,null)):c.length>0?c.map((e=>(0,t.createElement)(C,{key:e.path,folder:e,onFolderClick:a,currentPath:r,level:l+1,isOpen:!!s.openFolders[e.path],onToggle:s}))):f?(0,t.createElement)("div",{className:"rz-folder-tree-item__empty",style:{paddingLeft:16*(l+1)+"px"}},(0,E.__)("No subfolders","rz-file-manager")):null))})),N=()=>{const{currentPath:e,navigateTo:a}=y(),[r,l]=(0,n.useState)([]),[o,s]=(0,n.useState)(!0),[c,d]=(0,n.useState)({"":!0});(0,n.useEffect)((()=>{(async()=>{s(!0);try{const e=await i("");if(e.success&&e.items){const e={name:(0,E.__)("Root","rz-file-manager"),path:"",type:"folder"};l([e])}}catch(e){console.error("Error loading root folders:",e)}finally{s(!1)}})()}),[]),(0,n.useEffect)((()=>{const t=function(e){const t=[];let n=e;for(;n;){t.unshift(n);const e=n.lastIndexOf("/");if(e<=0)break;n=n.slice(0,e)}return t.includes("")||t.unshift(""),t}(e);d((e=>{const n={...e};return t.forEach((e=>{n[e]=!0})),n}))}),[e]);const m=(0,n.useCallback)((e=>{d((t=>({...t,[e]:!t[e]})))}),[]);m.openFolders=c;const u=e=>{a(e)};return(0,t.createElement)("div",{className:"rz-file-manager__folder-tree",id:"folder-tree-container"},(0,t.createElement)("h3",{className:"rz-file-manager__sidebar-title"},(0,E.__)("Folders","rz-file-manager")),o?(0,t.createElement)("div",{className:"rz-file-manager__folder-tree-loading"},(0,t.createElement)(_.Spinner,null)):(0,t.createElement)("div",{className:"rz-folder-tree"},r.map((n=>(0,t.createElement)(C,{key:n.path,folder:n,onFolderClick:u,currentPath:e,level:0,isOpen:!!c[n.path],onToggle:m})))))},S=({isOpen:e,onClose:a})=>{const{currentPath:r,handleCreateFolder:l}=y(),[o,i]=(0,n.useState)(""),[s,c]=(0,n.useState)("");return(0,t.createElement)(_.Modal,{title:(0,E.__)("Create New Folder","rz-file-manager"),onRequestClose:a,className:"rz-file-manager__modal"},(0,t.createElement)("form",{onSubmit:e=>{e.preventDefault(),o?/[\\/:*?"<>|]/.test(o)?c((0,E.__)("Folder name contains invalid characters.","rz-file-manager")):(l(o),a()):c((0,E.__)("Please enter a folder name.","rz-file-manager"))}},(0,t.createElement)("div",{className:"rz-file-manager__modal-content"},(0,t.createElement)("p",null,(0,E.__)("Create a new folder in:","rz-file-manager"),(0,t.createElement)("strong",null,r||"/")),(0,t.createElement)(_.TextControl,{label:(0,E.__)("Folder Name","rz-file-manager"),value:o,__nextHasNoMarginBottom:!0,onChange:e=>{i(e),c("")},placeholder:(0,E.__)("Enter folder name","rz-file-manager"),autoFocus:!0}),s&&(0,t.createElement)("div",{className:"rz-file-manager__modal-error"},s)),(0,t.createElement)("div",{className:"rz-file-manager__modal-footer"},(0,t.createElement)(_.Button,{variant:"secondary",onClick:a},(0,E.__)("Cancel","rz-file-manager")),(0,t.createElement)(_.Button,{variant:"primary",type:"submit"},(0,E.__)("Create Folder","rz-file-manager")))))},O=({isOpen:e,onClose:a,item:r})=>{const{handleRenameItem:l}=y(),[o,i]=(0,n.useState)(""),[s,c]=(0,n.useState)("");return(0,n.useEffect)((()=>{r&&i(r.name)}),[r]),(0,t.createElement)(_.Modal,{title:(0,E.__)("Rename","rz-file-manager"),onRequestClose:a,className:"rz-file-manager__modal"},(0,t.createElement)("form",{onSubmit:e=>{e.preventDefault(),o?/[\\/:*?"<>|]/.test(o)?c((0,E.__)("Name contains invalid characters.","rz-file-manager")):o!==r.name?(l(r.path,o),a()):a():c((0,E.__)("Please enter a name.","rz-file-manager"))}},(0,t.createElement)("div",{className:"rz-file-manager__modal-content"},(0,t.createElement)("p",null,r&&"directory"===r.type?(0,E.__)("Rename folder:","rz-file-manager"):(0,E.__)("Rename file:","rz-file-manager"),(0,t.createElement)("strong",null,r?r.name:"")),(0,t.createElement)(_.TextControl,{label:(0,E.__)("New Name","rz-file-manager"),value:o,onChange:e=>{i(e),c("")},placeholder:(0,E.__)("Enter new name","rz-file-manager"),autoFocus:!0}),s&&(0,t.createElement)("div",{className:"rz-file-manager__modal-error"},s)),(0,t.createElement)("div",{className:"rz-file-manager__modal-footer"},(0,t.createElement)(_.Button,{variant:"secondary",onClick:a},(0,E.__)("Cancel","rz-file-manager")),(0,t.createElement)(_.Button,{variant:"primary",type:"submit"},(0,E.__)("Rename","rz-file-manager")))))},x=()=>{const{deleteModalState:e,closeDeleteModal:n,handleDeleteSelectedItems:a,loading:r}=y();if(!e.isOpen||!e.itemsToDelete)return null;const l=e.itemsToDelete.length,o=1===l?(0,E.sprintf)((0,E.__)('Are you sure you want to delete "%s"?',"rz-file-manager"),e.itemsToDelete[0]?.name):(0,E.sprintf)((0,E.__)("Are you sure you want to delete %d selected items?","rz-file-manager"),l);return(0,t.createElement)(_.Modal,{title:(0,E.__)("Confirm Deletion","rz-file-manager"),onRequestClose:n,className:"rz-file-manager__modal rz-file-manager__delete-modal",shouldCloseOnClickOutside:!0,shouldCloseOnEsc:!0},(0,t.createElement)("div",{className:"rz-file-manager__modal-content"},(0,t.createElement)("p",null,o),(0,t.createElement)("p",{className:"rz-fm-delete-warning"},(0,E.__)("This action cannot be undone.","rz-file-manager"))),(0,t.createElement)("div",{className:"rz-file-manager__modal-footer"},(0,t.createElement)(_.Button,{variant:"secondary",onClick:n,disabled:r},(0,E.__)("Cancel","rz-file-manager")),(0,t.createElement)(_.Button,{variant:"primary",onClick:()=>{a()},isDestructive:!0,disabled:r},r?(0,E.__)("Deleting...","rz-file-manager"):(0,E.__)("Delete","rz-file-manager"))))},k=({isOpen:e,onClose:a})=>{const{currentPath:r,handleUploadFiles:l,uploadError:o,clearUploadError:i}=y(),s=(0,n.useRef)(null),[c,d]=(0,n.useState)([]),[m,u]=(0,n.useState)({}),[f,p]=(0,n.useState)({});(0,n.useEffect)((()=>{e&&(d([]),i())}),[e,i]);const g=()=>{i(),a()};return(0,t.createElement)(_.Modal,{title:(0,E.__)("Upload Files","rz-file-manager"),onRequestClose:g,className:"rz-file-manager__modal rz-file-manager__upload-modal"},o&&(0,t.createElement)("div",{className:"rz-fm-upload-error"},"Error: ",o),(0,t.createElement)("form",{onSubmit:e=>{e.preventDefault(),0!==c.length&&l(c,r,{onProgress:(e,t)=>{u((n=>({...n,[e.name]:t})))},onError:(e,t)=>{p((n=>({...n,[e.name]:t})))},onComplete:()=>{a()}})}},(0,t.createElement)("div",{className:"rz-file-manager__modal-content"},(0,t.createElement)("p",null,(0,E.__)("Upload files to:","rz-file-manager"),(0,t.createElement)("strong",null,r||"/")),(0,t.createElement)("div",{className:"rz-file-manager__upload-area"},(0,t.createElement)("input",{type:"file",ref:s,onChange:e=>{const t=Array.from(e.target.files);d(t),u({}),p({}),i()},multiple:!0,style:{display:"none"}}),(0,t.createElement)(_.Button,{variant:"secondary",onClick:()=>{s.current.click()},className:"rz-file-manager__browse-button"},(0,E.__)("Browse Files","rz-file-manager")),(0,t.createElement)("p",{className:"rz-file-manager__upload-info"},c.length>0?(0,E.__)(`${c.length} file(s) selected`,"rz-file-manager"):(0,E.__)("No files selected","rz-file-manager"))),c.length>0&&(0,t.createElement)("div",{className:"rz-file-manager__selected-files"},(0,t.createElement)("h3",null,(0,E.__)("Selected Files","rz-file-manager")),(0,t.createElement)("ul",{className:"rz-file-manager__file-list"},c.map(((e,n)=>(0,t.createElement)("li",{key:n,className:"rz-file-manager__file-item"},(0,t.createElement)("div",{className:"rz-file-manager__file-info"},(0,t.createElement)("span",{className:"rz-file-manager__file-name"},e.name),(0,t.createElement)("span",{className:"rz-file-manager__file-size"},"(",(e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB"][t]})(e.size),")")),void 0!==m[e.name]&&(0,t.createElement)(_.ProgressBar,{value:m[e.name],className:"rz-file-manager__progress"}),f[e.name]&&(0,t.createElement)("div",{className:"rz-file-manager__file-error"},f[e.name]))))))),(0,t.createElement)("div",{className:"rz-file-manager__modal-footer"},(0,t.createElement)(_.Button,{variant:"secondary",onClick:g},(0,E.__)("Cancel","rz-file-manager")),(0,t.createElement)(_.Button,{variant:"primary",type:"submit",disabled:0===c.length},(0,E.__)("Upload","rz-file-manager")))))},F=()=>{const{newFileModalState:e,closeNewFileModal:a,handleCreateFile:r,loading:l,error:o,setError:i}=y(),[s,c]=(0,n.useState)(""),[d,m]=(0,n.useState)("");return(0,n.useEffect)((()=>{e.isOpen?(c(""),m(""),o&&i(null)):(c(""),m(""))}),[e.isOpen]),e.isOpen?(0,t.createElement)(_.Modal,{title:(0,E.__)("Create New File","rz-file-manager"),onRequestClose:a,className:"rz-file-manager__modal rz-file-manager__new-file-modal",shouldCloseOnClickOutside:!l,shouldCloseOnEsc:!l},(0,t.createElement)("form",{onSubmit:e=>{if(e.preventDefault(),m(""),console.log("[NewFileModal] handleSubmit called"),!s.trim())return console.log("[NewFileModal] Validation failed: Filename empty"),void m((0,E.__)("Filename cannot be empty.","rz-file-manager"));const t=/[\\\\/:*?"<>|]/g;return console.log("[NewFileModal] Checking filename against regex:",t),t.test(s)?(console.log("[NewFileModal] Validation failed: Invalid characters"),void m((0,E.__)('Filename contains invalid characters (\\\\ / : * ? " < > |).',"rz-file-manager"))):(console.log("[NewFileModal] Checking for extension"),!s.includes(".")||s.endsWith(".")?(console.log("[NewFileModal] Validation failed: Missing or invalid extension"),void m((0,E.__)("Please include a file extension (e.g., .txt, .html).","rz-file-manager"))):(console.log("[NewFileModal] Validation passed. Calling handleCreateFile with:",s.trim()),void r(s.trim())))}},(0,t.createElement)("div",{className:"rz-file-manager__modal-content"},(0,t.createElement)(_.TextControl,{label:(0,E.__)("Filename (including extension)","rz-file-manager"),value:s,onChange:c,placeholder:(0,E.__)("e.g., document.txt, image.jpg","rz-file-manager"),help:d||(0,E.__)("Enter the name for the new file, including its extension.","rz-file-manager"),className:d?"has-error":"",autoFocus:!0,disabled:l,__nextHasNoMarginBottom:!0})),(0,t.createElement)("div",{className:"rz-file-manager__modal-footer"},(0,t.createElement)(_.Button,{variant:"secondary",onClick:a,disabled:l},(0,E.__)("Cancel","rz-file-manager")),(0,t.createElement)(_.Button,{variant:"primary",type:"submit",isBusy:l,disabled:l||!s.trim()||d},l?(0,E.__)("Creating...","rz-file-manager"):(0,E.__)("Create File","rz-file-manager"))))):null};function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(Object(n),!0).forEach((function(t){P(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function $(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){R(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function U(e){return function t(){for(var n=this,a=arguments.length,r=new Array(a),l=0;l<a;l++)r[l]=arguments[l];return r.length>=e.length?e.apply(this,r):function(){for(var e=arguments.length,a=new Array(e),l=0;l<e;l++)a[l]=arguments[l];return t.apply(n,[].concat(r,a))}}}function B(e){return{}.toString.call(e).includes("Object")}function L(e){return"function"==typeof e}var A=U((function(e,t){throw new Error(e[t]||e.default)}))({initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"}),V=function(e,t){return B(t)||A("changeType"),Object.keys(t).some((function(t){return n=e,a=t,!Object.prototype.hasOwnProperty.call(n,a);var n,a}))&&A("changeField"),t},q=function(e){L(e)||A("selectorType")},H=function(e){L(e)||B(e)||A("handlerType"),B(e)&&Object.values(e).some((function(e){return!L(e)}))&&A("handlersType")},W=function(e){var t;e||A("initialIsRequired"),B(e)||A("initialType"),t=e,Object.keys(t).length||A("initialContent")};function K(e,t){return L(t)?t(e.current):t}function Z(e,t){return e.current=$($({},e.current),t),t}function X(e,t,n){return L(t)?t(e.current):Object.keys(n).forEach((function(n){var a;return null===(a=t[n])||void 0===a?void 0:a.call(t,e.current[n])})),n}const G=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};W(e),H(t);var n={current:e},a=U(X)(n,t),r=U(Z)(n),l=U(V)(e),o=U(K)(n);return[function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e};return q(e),e(n.current)},function(e){!function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduceRight((function(e,t){return t(e)}),e)}}(a,r,l,o)(e)}]};var J,Y={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:"Deprecation warning!\n    You are using deprecated way of configuration.\n\n    Instead of using\n      monaco.config({ urls: { monacoBase: '...' } })\n    use\n      monaco.config({ paths: { vs: '...' } })\n\n    For more please check the link https://github.com/suren-atoyan/monaco-loader#config\n  "},Q=(J=function(e,t){throw new Error(e[t]||e.default)},function e(){for(var t=this,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return a.length>=J.length?J.apply(this,a):function(){for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return e.apply(t,[].concat(a,r))}})(Y);const ee={config:function(e){return e||Q("configIsRequired"),t=e,{}.toString.call(t).includes("Object")||Q("configType"),e.urls?(console.warn(Y.deprecation),{paths:{vs:e.urls.monacoBase}}):e;var t}},te=function e(t,n){return Object.keys(n).forEach((function(a){n[a]instanceof Object&&t[a]&&Object.assign(n[a],e(t[a],n[a]))})),j(j({},t),n)};var ne={type:"cancelation",msg:"operation is manually canceled"};const ae=function(e){var t=!1,n=new Promise((function(n,a){e.then((function(e){return t?a(ne):n(e)})),e.catch(a)}));return n.cancel=function(){return t=!0},n};var re,le=function(e){if(Array.isArray(e))return e}(re=G({config:{paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs"}},isInitialized:!1,resolve:null,reject:null,monaco:null}))||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var t=[],_n=!0,n=!1,a=void 0;try{for(var r,l=e[Symbol.iterator]();!(_n=(r=l.next()).done)&&(t.push(r.value),2!==t.length);_n=!0);}catch(e){n=!0,a=e}finally{try{_n||null==l.return||l.return()}finally{if(n)throw a}}return t}}(re)||function(e){if(e){if("string"==typeof e)return I(e,2);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?I(e,2):void 0}}(re)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),oe=le[0],ie=le[1];function se(e){return document.body.appendChild(e)}function ce(e){var t,n,a=oe((function(e){return{config:e.config,reject:e.reject}})),r=(t="".concat(a.config.paths.vs,"/loader.js"),n=document.createElement("script"),t&&(n.src=t),n);return r.onload=function(){return e()},r.onerror=a.reject,r}function de(){var e=oe((function(e){return{config:e.config,resolve:e.resolve,reject:e.reject}})),t=window.require;t.config(e.config),t(["vs/editor/editor.main"],(function(t){me(t),e.resolve(t)}),(function(t){e.reject(t)}))}function me(e){oe().monaco||ie({monaco:e})}var ue=new Promise((function(e,t){return ie({resolve:e,reject:t})})),fe={config:function(e){var t=ee.config(e),n=t.monaco,a=function(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(t,["monaco"]);ie((function(e){return{config:te(e.config,a),monaco:n}}))},init:function(){var e=oe((function(e){return{monaco:e.monaco,isInitialized:e.isInitialized,resolve:e.resolve}}));if(!e.isInitialized){if(ie({isInitialized:!0}),e.monaco)return e.resolve(e.monaco),ae(ue);if(window.monaco&&window.monaco.editor)return me(window.monaco),e.resolve(window.monaco),ae(ue);!function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduceRight((function(e,t){return t(e)}),e)}}(se,ce)(de)}return ae(ue)},__getMonacoInstance:function(){return oe((function(e){return e.monaco}))}};const pe=fe;var ge={display:"flex",position:"relative",textAlign:"initial"},he={width:"100%"},ye={display:"none"},Ee={container:{display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"}},_e=function({children:e}){return t.createElement("div",{style:Ee.container},e)},we=(0,t.memo)((function({width:e,height:n,isEditorReady:a,loading:r,_ref:l,className:o,wrapperProps:i}){return t.createElement("section",{style:{...ge,width:e,height:n},...i},!a&&t.createElement(_e,null,r),t.createElement("div",{ref:l,style:{...he,...!a&&ye},className:o}))})),ve=function(e){(0,t.useEffect)(e,[])},be=function(e,n,a=!0){let r=(0,t.useRef)(!0);(0,t.useEffect)(r.current||!a?()=>{r.current=!1}:e,n)};function ze(){}function Me(e,t,n,a){return function(e,t){return e.editor.getModel(Ce(e,t))}(e,a)||function(e,t,n,a){return e.editor.createModel(t,n,a?Ce(e,a):void 0)}(e,t,n,a)}function Ce(e,t){return e.Uri.parse(t)}(0,t.memo)((function({original:e,modified:n,language:a,originalLanguage:r,modifiedLanguage:l,originalModelPath:o,modifiedModelPath:i,keepCurrentOriginalModel:s=!1,keepCurrentModifiedModel:c=!1,theme:d="light",loading:m="Loading...",options:u={},height:f="100%",width:p="100%",className:g,wrapperProps:h={},beforeMount:y=ze,onMount:E=ze}){let[_,w]=(0,t.useState)(!1),[v,b]=(0,t.useState)(!0),z=(0,t.useRef)(null),M=(0,t.useRef)(null),C=(0,t.useRef)(null),N=(0,t.useRef)(E),S=(0,t.useRef)(y),O=(0,t.useRef)(!1);ve((()=>{let e=pe.init();return e.then((e=>(M.current=e)&&b(!1))).catch((e=>"cancelation"!==e?.type&&console.error("Monaco initialization: error:",e))),()=>z.current?function(){let e=z.current?.getModel();s||e?.original?.dispose(),c||e?.modified?.dispose(),z.current?.dispose()}():e.cancel()})),be((()=>{if(z.current&&M.current){let t=z.current.getOriginalEditor(),n=Me(M.current,e||"",r||a||"text",o||"");n!==t.getModel()&&t.setModel(n)}}),[o],_),be((()=>{if(z.current&&M.current){let e=z.current.getModifiedEditor(),t=Me(M.current,n||"",l||a||"text",i||"");t!==e.getModel()&&e.setModel(t)}}),[i],_),be((()=>{let e=z.current.getModifiedEditor();e.getOption(M.current.editor.EditorOption.readOnly)?e.setValue(n||""):n!==e.getValue()&&(e.executeEdits("",[{range:e.getModel().getFullModelRange(),text:n||"",forceMoveMarkers:!0}]),e.pushUndoStop())}),[n],_),be((()=>{z.current?.getModel()?.original.setValue(e||"")}),[e],_),be((()=>{let{original:e,modified:t}=z.current.getModel();M.current.editor.setModelLanguage(e,r||a||"text"),M.current.editor.setModelLanguage(t,l||a||"text")}),[a,r,l],_),be((()=>{M.current?.editor.setTheme(d)}),[d],_),be((()=>{z.current?.updateOptions(u)}),[u],_);let x=(0,t.useCallback)((()=>{if(!M.current)return;S.current(M.current);let t=Me(M.current,e||"",r||a||"text",o||""),s=Me(M.current,n||"",l||a||"text",i||"");z.current?.setModel({original:t,modified:s})}),[a,n,l,e,r,o,i]),k=(0,t.useCallback)((()=>{!O.current&&C.current&&(z.current=M.current.editor.createDiffEditor(C.current,{automaticLayout:!0,...u}),x(),M.current?.editor.setTheme(d),w(!0),O.current=!0)}),[u,d,x]);return(0,t.useEffect)((()=>{_&&N.current(z.current,M.current)}),[_]),(0,t.useEffect)((()=>{!v&&!_&&k()}),[v,_,k]),t.createElement(we,{width:p,height:f,isEditorReady:_,loading:m,_ref:C,className:g,wrapperProps:h})}));var Ne=new Map,Se=(0,t.memo)((function({defaultValue:e,defaultLanguage:n,defaultPath:a,value:r,language:l,path:o,theme:i="light",line:s,loading:c="Loading...",options:d={},overrideServices:m={},saveViewState:u=!0,keepCurrentModel:f=!1,width:p="100%",height:g="100%",className:h,wrapperProps:y={},beforeMount:E=ze,onMount:_=ze,onChange:w,onValidate:v=ze}){let[b,z]=(0,t.useState)(!1),[M,C]=(0,t.useState)(!0),N=(0,t.useRef)(null),S=(0,t.useRef)(null),O=(0,t.useRef)(null),x=(0,t.useRef)(_),k=(0,t.useRef)(E),F=(0,t.useRef)(),P=(0,t.useRef)(r),D=function(e){let n=(0,t.useRef)();return(0,t.useEffect)((()=>{n.current=e}),[e]),n.current}(o),j=(0,t.useRef)(!1),I=(0,t.useRef)(!1);ve((()=>{let e=pe.init();return e.then((e=>(N.current=e)&&C(!1))).catch((e=>"cancelation"!==e?.type&&console.error("Monaco initialization: error:",e))),()=>S.current?(F.current?.dispose(),f?u&&Ne.set(o,S.current.saveViewState()):S.current.getModel()?.dispose(),void S.current.dispose()):e.cancel()})),be((()=>{let t=Me(N.current,e||r||"",n||l||"",o||a||"");t!==S.current?.getModel()&&(u&&Ne.set(D,S.current?.saveViewState()),S.current?.setModel(t),u&&S.current?.restoreViewState(Ne.get(o)))}),[o],b),be((()=>{S.current?.updateOptions(d)}),[d],b),be((()=>{!S.current||void 0===r||(S.current.getOption(N.current.editor.EditorOption.readOnly)?S.current.setValue(r):r!==S.current.getValue()&&(I.current=!0,S.current.executeEdits("",[{range:S.current.getModel().getFullModelRange(),text:r,forceMoveMarkers:!0}]),S.current.pushUndoStop(),I.current=!1))}),[r],b),be((()=>{let e=S.current?.getModel();e&&l&&N.current?.editor.setModelLanguage(e,l)}),[l],b),be((()=>{void 0!==s&&S.current?.revealLine(s)}),[s],b),be((()=>{N.current?.editor.setTheme(i)}),[i],b);let R=(0,t.useCallback)((()=>{if(O.current&&N.current&&!j.current){k.current(N.current);let t=o||a,c=Me(N.current,r||e||"",n||l||"",t||"");S.current=N.current?.editor.create(O.current,{model:c,automaticLayout:!0,...d},m),u&&S.current.restoreViewState(Ne.get(t)),N.current.editor.setTheme(i),void 0!==s&&S.current.revealLine(s),z(!0),j.current=!0}}),[e,n,a,r,l,o,d,m,u,i,s]);return(0,t.useEffect)((()=>{b&&x.current(S.current,N.current)}),[b]),(0,t.useEffect)((()=>{!M&&!b&&R()}),[M,b,R]),P.current=r,(0,t.useEffect)((()=>{b&&w&&(F.current?.dispose(),F.current=S.current?.onDidChangeModelContent((e=>{I.current||w(S.current.getValue(),e)})))}),[b,w]),(0,t.useEffect)((()=>{if(b){let e=N.current.editor.onDidChangeMarkers((e=>{let t=S.current.getModel()?.uri;if(t&&e.find((e=>e.path===t.path))){let e=N.current.editor.getModelMarkers({resource:t});v?.(e)}}));return()=>{e?.dispose()}}return()=>{}}),[b,v]),t.createElement(we,{width:p,height:g,isEditorReady:b,loading:c,_ref:O,className:h,wrapperProps:y})}));const Oe=()=>{const{editorState:e,closeFileEditor:n,saveEditedFile:a,handleEditorContentChange:r}=y();if(!e.isOpen)return null;const{file:l,content:o,isLoading:i,error:s}=e,c=(e=>{if(!e)return"plaintext";const t=e.split(".").pop()?.toLowerCase();switch(t){case"js":case"jsx":return"javascript";case"ts":case"tsx":return"typescript";case"css":return"css";case"scss":return"scss";case"less":return"less";case"html":return"html";case"json":return"json";case"php":return"php";case"md":return"markdown";case"yaml":case"yml":return"yaml";case"xml":return"xml";case"py":return"python";case"sql":return"sql";default:return"plaintext"}})(l?.name);return(0,t.createElement)(_.Modal,{title:l?`${(0,E.__)("Edit File","rz-file-manager")}: ${l.name}`:(0,E.__)("Edit File","rz-file-manager"),onRequestClose:n,className:"rz-file-manager-editor-modal",shouldCloseOnClickOutside:!0,isDismissible:!i},i&&!o&&(0,t.createElement)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px"}},(0,t.createElement)(_.Spinner,null)),!i&&s&&(0,t.createElement)("div",{className:"rz-file-manager-editor-modal__error",style:{color:"red",marginBottom:"1em"}},(0,t.createElement)("p",null,(0,t.createElement)("strong",null,(0,E.__)("Error","rz-file-manager"),":")," ",s)),(!i||o)&&!s&&(0,t.createElement)(Se,{height:"50vh",language:c,value:o,theme:"vs-light",options:{lineNumbers:"on",minimap:{enabled:!0,side:"right",size:"proportional",showSlider:"mouseover",renderCharacters:!1,maxColumn:120},wordWrap:"on",scrollBeyondLastLine:!1,readOnly:i},onChange:r,onMount:(e,t)=>{}}),(0,t.createElement)("div",{className:"rz-file-manager-editor-modal__actions",style:{marginTop:"1em",display:"flex",justifyContent:"flex-end"}},(0,t.createElement)(_.Button,{isSecondary:!0,onClick:n,disabled:i,style:{marginRight:"8px"}},(0,E.__)("Cancel","rz-file-manager")),(0,t.createElement)(_.Button,{isPrimary:!0,onClick:a,isBusy:i,disabled:i||!!s},(0,E.__)("Save Changes","rz-file-manager"))))},xe=window.ReactDOM,ke=(e,t)=>e.some((e=>e.path===t.path))?e:[t],Fe=()=>{const{contextMenu:e,hideContextMenu:n,openFileEditor:a,openRenameModal:r,openDeleteModal:l,handleRenameItem:o,handleCreateFolder:i,handleCreateFile:s,selectedItems:c,handleCopyItems:d,handleMoveItems:m,handleDownloadItem:u,handleDownloadZip:f,handleZipItem:p,handleUnzipItem:g,clipboardState:h,handleCutItems:_,handlePasteItems:w,openNewFileModal:v,openUploadModal:b,openCreateFolderModal:z}=y(),M=(0,t.useRef)(null);if((0,t.useEffect)((()=>{const t=e=>{M.current&&!M.current.contains(e.target)&&n()};return e.visible?document.addEventListener("mousedown",t):document.removeEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}}),[e.visible,n]),!e.visible)return null;if(!e.item)return(0,xe.createPortal)((0,t.createElement)("div",{ref:M,className:"rz-file-manager-context-menu",style:{position:"fixed",top:e.y,left:e.x,zIndex:1e3}},(0,t.createElement)("ul",null,(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>{v(),n()}},(0,t.createElement)("span",{className:"dashicons dashicons-media-default",style:{marginRight:"5px"}})," ",(0,E.__)("New File","rz-file-manager"))),(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>{z(),n()}},(0,t.createElement)("span",{className:"dashicons dashicons-portfolio",style:{marginRight:"5px"}})," ",(0,E.__)("New Folder","rz-file-manager"))),(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>{b(),n()}},(0,t.createElement)("span",{className:"dashicons dashicons-upload",style:{marginRight:"5px"}})," ",(0,E.__)("Upload","rz-file-manager"))),h&&h.items&&h.items.length>0&&(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>{w(),n()}},(0,t.createElement)("span",{className:"dashicons dashicons-clipboard",style:{marginRight:"5px"}})," ",(0,E.__)("Paste","rz-file-manager"))))),document.body);const C={position:"absolute",top:`${e.y}px`,left:`${e.x}px`,zIndex:1e3},N=(0,t.createElement)("div",{ref:M,className:"rz-file-manager-context-menu",style:C},(0,t.createElement)("ul",null,"file"===e.item.type&&(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>{e.item&&"file"===e.item.type&&a(e.item),n()}},(0,t.createElement)("span",{className:"dashicons dashicons-edit",style:{marginRight:"5px"}})," ",(0,E.__)("Edit","rz-file-manager"))),(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>{if(!e.item)return;let t;"file"===e.item.type?t=(e=>{const t=window.rzFileManagerData?.ajaxUrl,n=window.rzFileManagerData?.ajaxNonce;return`${t}?action=rz_fm_download_item&path=${e}&_wpnonce=${n}`})(e.item.path):"directory"===e.item.type&&(t=(e=>{const t=window.rzFileManagerData?.ajaxUrl,n=window.rzFileManagerData?.ajaxNonce;return`${t}?action=rz_fm_download_zip&path=${e}&_wpnonce=${n}`})(e.item.path)),t&&(window.location.href=t),n()}},(0,t.createElement)("span",{className:"dashicons dashicons-download",style:{marginRight:"5px"}})," ",(0,E.__)("Download","rz-file-manager"))),(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>{e.item&&r(e.item),n()}},(0,t.createElement)("span",{className:"dashicons dashicons-tag",style:{marginRight:"5px"}})," Rename")),"file"===e.item.type&&(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>{e.item?(console.log("Zip clicked for:",e.item.path),p(e.item.path)):console.warn("Zip called with invalid selection",e.item),n()}},(0,t.createElement)("span",{className:"dashicons dashicons-archive",style:{marginRight:"5px"}})," ",(0,E.__)("Compress to .zip","rz-file-manager"))),e.item.name.toLowerCase().endsWith(".zip")&&"file"===e.item.type&&(0,t.createElement)(t.Fragment,null,(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>{e.item&&e.item.name.toLowerCase().endsWith(".zip")&&"file"===e.item.type?(console.log("Unzip clicked for:",e.item.path),g(e.item.path)):console.warn("Unzip called with invalid selection",e.item),n()}},(0,t.createElement)("span",{className:"dashicons dashicons-unlock",style:{marginRight:"5px"}}),`Extract to folder "${e.item.name.replace(/\.zip$/i,"")}"`)),(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>{e.item&&e.item.name.toLowerCase().endsWith(".zip")&&"file"===e.item.type?(console.log("Unzip Here clicked for:",e.item.path),g(e.item.path,!0)):console.warn("Unzip Here called with invalid selection",e.item),n()}},(0,t.createElement)("span",{className:"dashicons dashicons-unlock",style:{marginRight:"5px"}})," Extract here"))),e.item&&(0,t.createElement)(t.Fragment,null,(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>{const t=ke(c,e.item);d(t),n()}},(0,t.createElement)("span",{className:"dashicons dashicons-admin-page",style:{marginRight:"5px"}})," ",(0,E.__)("Copy","rz-file-manager"))),(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>{const t=ke(c,e.item);_(t),n()}},(0,t.createElement)("span",{className:"dashicons dashicons-hammer",style:{marginRight:"5px"}})," ",(0,E.__)("Cut","rz-file-manager"))),(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>{const t=c.some((t=>t.path===e.item.path))?c:[e.item];console.log("Delete clicked. Items to target:",t),l(t),n()},style:{color:"red"}},(0,t.createElement)("span",{className:"dashicons dashicons-trash",style:{marginRight:"5px"}})," ",(0,E.__)("Delete","rz-file-manager")))),(0,t.createElement)("li",null,(0,t.createElement)("button",{onClick:()=>{w(),n()},disabled:!h.action},(0,t.createElement)("span",{className:"dashicons dashicons-editor-paste-text",style:{marginRight:"5px"}})," ",(0,E.__)("Paste","rz-file-manager")))));return(0,xe.createPortal)(N,document.body)},Pe=()=>{const{loading:e,error:n,successMessage:a,clearMessages:r,showContextMenu:l,renameModalState:o,openRenameModal:i,closeRenameModal:s,createFolderModalState:c,openCreateFolderModal:d,closeCreateFolderModal:m,deleteModalState:u,openDeleteModal:f,closeDeleteModal:p,hideContextMenu:g,uploadModalState:h,openUploadModal:E,closeUploadModal:z}=y();return(0,t.useEffect)((()=>(window.rzShowContextMenu=l,()=>{window.rzShowContextMenu=void 0})),[l]),(0,t.createElement)("div",{className:"rz-file-manager",onClick:()=>{g()}},n&&(0,t.createElement)(_.Notice,{status:"error",isDismissible:!0,onRemove:r},n),a&&(0,t.createElement)(w,{message:a,onRemove:r}),(0,t.createElement)(v,{onCreateFolder:d,onDelete:f,onUpload:E}),(0,t.createElement)("div",{className:"rz-file-manager__content"},(0,t.createElement)("div",{className:"rz-file-manager__sidebar"},(0,t.createElement)(N,null)),(0,t.createElement)("div",{className:"rz-file-manager__main",onContextMenu:e=>{e.target.closest(".rz-file-manager__table-row")||(e.preventDefault(),"undefined"!=typeof window&&window?.rzShowContextMenu&&window.rzShowContextMenu(null,e))}},(0,t.createElement)(b,null),e?(0,t.createElement)("div",{className:"rz-file-manager__loading"},(0,t.createElement)(_.Spinner,null)):(0,t.createElement)(M,null))),c.isOpen&&(0,t.createElement)(S,{isOpen:c.isOpen,onClose:m}),o.isOpen&&(0,t.createElement)(O,{isOpen:o.isOpen,onClose:s,item:o.item}),u.isOpen&&(0,t.createElement)(x,{isOpen:u.isOpen,onClose:p}),h.isOpen&&(0,t.createElement)(k,{isOpen:h.isOpen,onClose:z}),(0,t.createElement)(Fe,null),(0,t.createElement)(Oe,null),(0,t.createElement)(F,null))},De=()=>(0,t.createElement)(g,null,(0,t.createElement)("div",{className:"rz-file-manager-app"},(0,t.createElement)(Pe,null)));document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("rz-file-manager-root");e&&(0,n.render)((0,t.createElement)(g,null,(0,t.createElement)(De,null)),e)}))})();